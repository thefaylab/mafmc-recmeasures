---
title: "performance-metric-kw"
author: "Kamran Walsh"
date: "2024-08-06"
output: html_document
---

Code for all plots/post-MSE run analyses 

Functions:
```{r}
#projection plot
projection.plot <- function(project.results) {
  project.results <- project.results %>% 
    #filter(type %in% c("biomass","catch")) %>%
    I()
  project.results %>% 
    #group_by(scenario, type, year) %>% 
    #median_qi(value, .width = c(.5, .8, .95)) %>%
    ggplot() +  
    stat_lineribbon(aes(x = year, y = value, fill = scenario),
                    #show.legend = FALSE,
                    alpha = 0.35) +
    # geom_lineribbon(aes(x = year, y = value, ymin = .lower, ymax = .upper, fill = scenario),
    #                 show.legend = FALSE) +
    scale_fill_brewer(type = "qual", palette = 2) +
    facet_wrap(~type, scale = "free") + 
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==1), lty=1,lwd=0.5,col=gray(0.7),alpha=0.5) +
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==2), lty=1,lwd=0.5,col=gray(0.7),alpha=0.5) +
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==3), lty=1,lwd=0.5,col=gray(0.7),alpha=0.5) +
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==4), lty=1,lwd=0.5,col=gray(0.7),alpha=0.5) +
    ylim(0,NA) + 
    ylab("") + 
    theme_bw() +
    theme(legend.position="bottom") + #,
          #axis.text.y = element_blank()) +
    labs(fill = "")
}

library(tidyverse)
library(ggdist)
library(scales)
library(fmsb)

#general scenario
read_results <- function(scendir =  "",
                         scen.name= "",
                         om.name = 1,
                         fsim = 1) {
  
 # scendir <- "~/Dropbox/fluke-mse/sims/2022-07-25/01-01/"
  #scendir = "~/research/mafmc-recmeasures/sims/001/"
  #scen.name="MP 1"
  #om.name = 1
  #fsim = 1
  print(scendir)

spawbio <- read.table(paste0(scendir,"spawbio.out"), header = TRUE)
totcatch <- read.table(paste0(scendir, "totcatch.out"), header = TRUE)
if(om.name!=1) sexcatch <- read.table(paste0(scendir, "sexcatch.out"), header = TRUE)
recoutput <- read.table(paste0(scendir, "recoutput.out"), header = FALSE, skip = 1) #TRUE)
recoutput2 <- read.table(paste0(scendir, "recoutput2.out"), header = FALSE, skip = 1) #TRUE)
rbctrack <- read.table(paste0(scendir, "rbctrack.out"), header = FALSE, skip = 1)
fout <- read.table(paste0(scendir,"frate.out"), header = TRUE)
names(spawbio) <- str_sub(names(spawbio), start=2)
names(totcatch) <- str_sub(names(totcatch), start=2)
if(om.name!=1) names(sexcatch) <- str_sub(names(sexcatch), start=2)
names(fout) <- str_sub(names(fout), start=2)
nsim = length(unique(rbctrack[,1]))
results <- spawbio %>% 
  as_tibble() %>% 
  rowid_to_column(var = "isim") %>% 
  pivot_longer(cols= 2:ncol(.), names_to = "year", values_to = "biomass") %>% 
  mutate(year = as.integer(year)) %>% 
  I()
res2 <- totcatch %>% 
  tibble() %>% 
  #rowid_to_column(var = "isim") %>% 
  mutate(isim = rep(1:(nrow(.)/4),each=4)) %>% 
  rename(fleet = L) %>%
  select(isim,everything()) %>% 
  pivot_longer(cols= 3:ncol(.), names_to = "year", values_to = "catch") %>% 
  mutate(year = as.integer(year)) %>% 
  group_by(isim, year) %>% 
  summarize(totcat_wt = sum(catch),
             keep_wt = sum(catch*(fleet==3)),
             release_wt = sum(catch*(fleet==4))) %>% 
  #pivot_wider(names_from = fleet, names_glue = "fleet_{fleet}", values_from = catch) %>% 
  I()
#res2
results <- results %>% 
  left_join(res2)

#recoutput - getting rid of extra outpt from iscen=1 & unfinished simulations
nyrs <- length(unique(recoutput[,2]))
# dummy <- recoutput %>% 
#   tibble() %>% 
#   slice(1:nyrs)
# dummy2 <- recoutput %>% 
#   tibble() %>% 
#   slice(((nyrs+1):nrow(.))) %>% 
#   filter(V1 != 1)
# temp <- bind_rows(dummy,dummy2)
# nsim <- floor(nrow(temp)/nyrs)
# recoutput <-  temp %>% 
#   slice((1:(nsim*nyrs)))

recoutput[,1] <- rep(1:nsim, each = 2*nyrs)
res3 <- recoutput[,1:4] %>% as_tibble()
names(res3) <- c("isim", "year", "type", "number") #,"trips")
res3 <- res3 %>% 
  mutate(#year = 2019 + year,
    type = ifelse(type==1, "keep_num", "release_num")) %>% 
  pivot_wider(names_from = "type", values_from = "number") %>% 
  I()


#recoutput2 - getting rid of extra outpt from iscen=1 & unfinished simulations
nyrs <- length(unique(recoutput2[,2]))
# dummy <- recoutput2 %>% 
#   tibble() %>% 
#   slice(1:(10*nyrs))
# dummy2 <- recoutput2 %>% 
#   tibble() %>% 
#   slice(((10*nyrs+1):nrow(.))) %>% 
#   filter(V1 != 1)
# temp <- bind_rows(dummy,dummy2)
# nsim <- floor(nrow(temp)/nyrs)
# recoutput2 <-  temp %>% 
#   slice((1:(nsim*nyrs*10)))
recoutput2[,1] <- rep(1:nsim, each = 10*nyrs)
names(recoutput2) <- c("isim","year","state","n_keep","n_release","ntrips","nchoice","change_cs","cost",
                        "keep_one", "mulen_keep","mulen_release","trophy")
#names(recoutput2) <- c("isim","year","state","ntrips","nchoice","change_cs","cost",
#                       "keep_one", "mulen_keep","mulen_release","trophy")
coast_recoutput <- recoutput2 %>% 
  filter(state == 1) #change this for coastwide, states, or both

res3 <- recoutput[,1:4] %>% as_tibble()
names(res3) <- c("isim", "year", "type", "number") #,"trips")
res3 <- res3 %>% 
  mutate(#year = 2019 + year,
    type = ifelse(type==1, "keep_num", "release_num")) %>% 
  pivot_wider(names_from = "type", values_from = "number") %>% 
  left_join(coast_recoutput) %>% 
  I()

results <- results %>% 
  left_join(res3)

rbc2 <- rbctrack %>% 
  tibble() %>% 
  select(1,2,4,15,9,10,11,12,18,22) %>% 
  I()
rbc2 <- rbctrack %>% 
  tibble() %>% 
  select(1,2,4,8,9,11,12,18,15:17) %>% 
  I()
#names(rbc2) <- c("isim","year","abc","fmsy","est_ofl","true_ofl","rhl","bmsy","msy","fem_ssb")
names(rbc2) <- c("isim","year","abc","fmsy","est_ofl","rhl","bmsy","exp_keep","seaslen","bag","minlen") #,"msy")
rbc2 <- rbc2 %>% 
  mutate(exp_keep = as.numeric(ifelse(exp_keep == "******************",NA,exp_keep))) %>% 
  mutate(year = 2019 + 2*year - 1) %>% 
  I()
results <- results %>% 
  left_join(rbc2)
  #mutate(scenario = rep("coastwide 14",nrow(.)))

# temp <- results %>% 
#   filter(year!=2019) %>% 
#   fill("abc","fmsy","est_ofl","true_ofl","rhl","bmsy","msy","fem_ssb")

temp <- results %>% 
  filter(year!=2019) %>% 
  fill("abc","fmsy","est_ofl",,"rhl","bmsy","exp_keep","seaslen","bag","minlen")

results <- results %>% 
  filter(year==2019) %>% 
  bind_rows(temp) %>% 
  arrange(isim,year)


# refpts <- read.table("mse/coast14/refpts.out", header = FALSE, skip = 1)
# names(refpts) <- c("isim", "fref", "bref", "cref")
# coast_results <- coast_results %>% 
#   left_join(refpts)

# 2024-06-14 GF commenting out because F is coming from rbctrack.out file (currently estF)
res4 <- fout %>%
  as_tibble() %>%
  rowid_to_column(var = "isim") %>%
  pivot_longer(cols= 2:ncol(.), names_to = "year", values_to = "frate") %>%
  mutate(year = as.integer(year)) %>%
  I()
results <- results %>%
  left_join(res4)

if(om.name!=1)  {
res5 <- sexcatch %>%
  tibble() %>%
  #rowid_to_column(var = "isim") %>%
  mutate(isim = rep(1:(nrow(.)/4),each=4)) %>%
  rename(fleet = L) %>%
  select(isim,everything()) %>%
  pivot_longer(cols= 3:ncol(.), names_to = "year", values_to = "prop_female") %>%
  mutate(year = as.integer(year)) %>%
  filter(fleet == 3) %>%
  select(-fleet) %>%
  # group_by(isim, year) %>%
  # summarize(totcat_wt = sum(catch),
  #           prop_fem = sum(catch*(fleet==3)),
  #           release_wt = sum(catch*(fleet==4))) %>%
  #pivot_wider(names_from = fleet, names_glue = "fleet_{fleet}", values_from = catch) %>%
  I()
#res5
results <- results %>%
  left_join(res5)
}

results <- results %>% 
  mutate(scenario = rep(scen.name,nrow(.)),
         om = rep(om.name, nrow(.)),
         isim = isim + fsim -1)

return(results)
}

get_diag_ts <- function(results) {
  
diag_ts <- results %>% 
  mutate(keep_to_rel = keep_num/release_num,
         change_cs = change_cs*-1,
       #  "kept per trip" = keep_num/ntrips,
       #  "rel per trip" = release_num/ntrips,
         "kept per trip" = 1000*keep_num/ntrips,
         "rel per trip" = 1000*release_num/ntrips,
         "F/Fref" = frate/fmsy,
         "B/Bref" = biomass/bmsy,
         "expense" = cost,
         cs_per_trip = change_cs/ntrips,
         rec_removals = keep_wt + release_wt,
         keep_one = keep_one/ntrips,
         keep_to_exp = 1000*keep_num / (exp_keep))  %>% 
  select(om, scenario, isim, year, biomass, totcat_wt, rec_removals, keep_to_rel, "kept per trip", "rel per trip",
         "F/Fref", "B/Bref",
         mulen_keep,
         mulen_release,
         trophy,
         expense,
         change_cs,
         ntrips,
         keep_one,
         cs_per_trip,
         prop_female,
         keep_to_exp,
         bag,
         minlen,
         seaslen,
         exp_keep
         ) %>% 
  rename("spawning biomass" = biomass,
         "total catch" = totcat_wt,
         "kept:released" = keep_to_rel) %>% 
  pivot_longer(cols=c("spawning biomass","total catch","kept:released", "kept per trip", 
                      "rel per trip",
                      "F/Fref", "B/Bref",
                      rec_removals,
                      mulen_keep,
                      mulen_release,
                      trophy,
                      expense,
                      change_cs,
                      ntrips,
                      keep_one,
                      cs_per_trip,
                      prop_female,
                      keep_to_exp,
                      bag,
                      minlen,
                      seaslen,
                      exp_keep
                      ),names_to = "type", values_to = "value") %>% 
  I()
 return(diag_ts)
}


get_om1_sexcatch <- function(scendir, scen.name) {
fsim=1
sexcatch <- read.table(paste0(scendir, "sexcatch.out"), header = TRUE)
names(sexcatch) <- str_sub(names(sexcatch), start=2)

  res5 <- sexcatch %>%
    tibble() %>%
    #rowid_to_column(var = "isim") %>%
    mutate(isim = rep(1:(nrow(.)/4),each=4)) %>%
    rename(fleet = L) %>%
    select(isim,everything()) %>%
    pivot_longer(cols= 3:ncol(.), names_to = "year", values_to = "prop_female") %>%
    mutate(year = as.integer(year)) %>%
    filter(fleet == 3) %>%
    select(-fleet) %>%
    # group_by(isim, year) %>%
    # summarize(totcat_wt = sum(catch),
    #           prop_fem = sum(catch*(fleet==3)),
    #           release_wt = sum(catch*(fleet==4))) %>%
    #pivot_wider(names_from = fleet, names_glue = "fleet_{fleet}", values_from = catch) %>%
    I()
  #res5
  
  results <- res5 %>% 
    mutate(scenario = rep(scen.name,nrow(.)),
           om = rep(1, nrow(.)),
           isim = isim + fsim -1)
  return(results)
}
#metrics <- median_metrics2 %>% rename(mp = RegType)

#add small radar plot for HCR
do_small_radar_plot <- function(metrics) {
  # metrics is a dataframe of metrics, expecting columns
  # metrics <- tibble(metric = rep(letters[1:5],each=3),
  #                   value = runif(15),
  #                   mp = as.character(rep(1:3,5)))
  # # metric 
  # # value
  # # mp (management procedure)
  summaries <- metrics %>% 
    group_by(metric) %>% 
    summarize(min = min(value, na.rm = TRUE),
              max = max(value, na.rm = TRUE)) %>% 
    #pivot_longer(cols = c(2:3),names_to = "mp",
    #             values_to = "value") %>% 
    #pivot_wider(names_from = metric, values_from = value) %>% 
    #arrange(desc(mp)) %>% 
    I()
  #summaries  
  nmetrics <- length(unique(metrics$metric))
  nmp <- length(unique(metrics$mp))
  
  d <- metrics %>% 
    group_by(mp) %>% 
    left_join(summaries) %>% 
    mutate(value = value/(max + 1e-08)) %>% 
    select(mp, metric, value) %>% 
    pivot_wider(names_from = metric, values_from = value) %>% 
    ungroup()
  
  bounds <- tibble(mp = c("max","min"),
                   
                   #"total catch" = c(1,0),
                   "kept:released" = c(1,0),
                   "kept per trip" = c(1,0),
                   "not overfishing" = c(1,0),
                   "not overfished" = c(1,0),
                  # "spawning biomass" = c(1,0),
                  # "rel per trip" = c(1,0),
                  # "cs_per_trip" = c(1,0),
                   #"change_cs" = c(1,0),
                   #"mulen_keep" = c(1,0),
                   #"mulen_release" = c(1,0),
                   "trophy" = c(1,0),
                  # "rec_removals" = c(1,0),
                   "keep_one" = c(1,0))# ,
                 #  "prop_female" = c(1,0),
                  # "ntrips" = c(1,0)) #,
  #filter(metric %in% c("change_cs", "kept per trip", "kept:released", "not overfished", "not overfishing")) %>% 
  #d = c(1,0),
  #e = c(1,0))
  
  dd <- bounds %>% 
    bind_rows(d)
  
  #NEW PLOT
  #colorblind colors
  colors_fill2<-c(alpha("#000000",0.1),
                  alpha("#E69F00",0.1),
                  alpha("#56B4E9",0.1),
                  alpha("#009E73",0.1),
                  alpha("#F0E442",0.1),
                  alpha("#E69F00",0.1),
                  alpha("#56B4E9",0.1),
                  alpha("#009E73",0.1))
  colors_line2<-c(alpha("#000000",0.9),
                  alpha("#E69F00",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#009E73",0.9),
                  alpha("#F0E442",0.9),
                  alpha("#E69F00",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#009E73",0.9))
  colors_line2<-c(alpha("#1b9e77",0.9),
                  alpha("#d95f02",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#dc14cf",0.9),
                  #alpha("#009E73",0.9),
                  alpha("#F0E442",0.9),
                  alpha("#E69F00",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#009E73",0.9))
  
  colors_fill2<-c(alpha("#1b9e77",0.1),
                  alpha("#d95f02",0.1),
                  alpha("#7570b3",0.1),
                  alpha("#e7298a",0.1),
                  alpha("#66a61e",0.1),
                  alpha("#e6ab02",0.1),
                  alpha("#a6761d",0.1),
                  alpha("#d95f02",0.1))
  
  colors_line2<-c(alpha("#1b9e77",0.9),
                  alpha("#d95f02",0.9),
                  alpha("#7570b3",0.9),
                  alpha("#e7298a",0.9),
                  alpha("#66a61e",0.9),
                  alpha("#e6ab02",0.9),
                  alpha("#a6761d",0.9),
                  alpha("#d95f02",0.9))
  
  #colorblind
  radarchart(dd[,-1],seg=5,pcol=colors_line2,
             pfcol=colors_fill2,plwd=2,
             vlabels=names(dd)[-1], vlcex=0.8,
             plty=c(rep(1,7),rep(2,7)),
             pdensity=0)
  rows<<-rownames(dd[-c(1,2),])
  colors_line<<-colors_line2
  legend("bottomright",inset=0,title ="",title.adj = 0.2,
         legend=unique(d$mp),
         pch=16,
         col=colors_line2[1:nmp],
         lty=1, cex=0.8, bty= 'n', y.intersp=1)
  
}
```

Switch 
```{r}
HCRtoplot <- "RDMBin1"
#change the folder names for the scenarios you want to summarize results for and give them a unique name
```

Read in Data:
- use numbers if merging to spreadsheet, character names (e.g. "BTable3.1") if using code in here

BASE2 sinatra_split "BASE2split" 4 reg types parallel - not in MS
```{r}
params <- if(HCRtoplot == "BASE2split"){list(
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim4_all/"
        ),
  scen.name = c(
1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16
  ),
  fsim = rep(1,16))
}
```

"BTable3", "LTable3",  "STable3", "ATable3",  "BTable3.1","LTable3.1", "STable3.1", "ATable3.1", "BTable3.2","LTable3.2", 
"STable3.2","ATable3.2","BTable3.3","LTable3.3", "STable3.3", "ATable3.3"

BASE2 sinatra original "BASE2" - not in MS
```{r}
params <- if(HCRtoplot == "BASE2"){list( #was 102024 before 11/22/24
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102024/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102624/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

BASE3 <- parallel sims sinatra_split "BASE3"- not in MS
```{r}
params <- if(HCRtoplot == "BASE3"){list( #check splits 1-80 vs 1,1,1,1,1,2,2,2,2,2, etc. with code 
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/1_bag/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/1_bag/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/1_bag/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/1_bag/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/1_bag/sim41_50/",
    
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/2_length/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/2_length/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/2_length/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/2_length/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/2_length/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/3_season/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/3_season/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/3_season/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/3_season/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/3_season/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/4_all/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/4_all/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/4_all/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/4_all/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BBM/4_all/sim41_50/",
       
            #BRP
     "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/1_bag/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/1_bag/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/1_bag/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/1_bag/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/1_bag/sim41_50/",
    
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/2_length/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/2_length/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/2_length/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/2_length/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/2_length/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/3_season/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/3_season/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/3_season/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/3_season/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/3_season/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/4_all/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/4_all/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/4_all/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/4_all/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/BRP/4_all/sim41_50/" ,
 
          
             #PCA 
   "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/1_bag/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/1_bag/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/1_bag/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/1_bag/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/1_bag/sim41_50/",
    
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/2_length/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/2_length/sim11_20/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/2_length/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/2_length/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/2_length/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/3_season/sim1_10/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/3_season/sim11_20/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/3_season/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/3_season/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/3_season/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/4_all/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/4_all/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/4_all/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/4_all/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/PCA/4_all/sim41_50/",
 
        
               #NCA
      "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/1_bag/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/1_bag/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/1_bag/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/1_bag/sim41_50/",
    
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/2_length/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/2_length/sim11_20/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/2_length/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/2_length/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/2_length/sim41_50/",

    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/3_season/sim1_10/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/3_season/sim11_20/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/3_season/sim21_30/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/3_season/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/3_season/sim41_50/",
       
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/4_all/sim1_10/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/4_all/sim11_20/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/4_all/sim21_30/",
             "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/4_all/sim31_40/",
               "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/102124/NCA/4_all/sim41_50/"
            ),
  scen.name = c(
    "BTable3_1",
"BTable3_2", 
"BTable3_3", 
"BTable3_4", 
"BTable3_5",  
"LTable3_1",  
"LTable3_2", 
"LTable3_3", 
"LTable3_4", 
"LTable3_5",
"STable3_1", 
"STable3_2", 
"STable3_3", 
"STable3_4",  
"STable3_5",  
"ATable3_1",  
"ATable3_2", 
"ATable3_3", 
"ATable3_4", 
"ATable3_5",

"BTable3.1_1",
"BTable3.1_2",
"BTable3.1_3", 
"BTable3.1_4",
"BTable3.1_5", 
"LTable3.1_1", 
"LTable3.1_2",
"LTable3.1_3", 
"LTable3.1_4",
"LTable3.1_5",
"STable3.1_1", 
"STable3.1_2", 
"STable3.1_3", 
"STable3.1_4", 
"STable3.1_5", 
"ATable3.1_1", 
"ATable3.1_2",
"ATable3.1_3", 
"ATable3.1_4",
"ATable3.1_5",

"BTable3.2_1",
"BTable3.2_2",
"BTable3.2_3",
"BTable3.2_4",
"BTable3.2_5",
"LTable3.2_1", 
"LTable3.2_2", 
"LTable3.2_3", 
"LTable3.2_4",
"LTable3.2_5",
"STable3.2_1",
"STable3.2_2", 
"STable3.2_3", 
"STable3.2_4", 
"STable3.2_5", 
"ATable3.2_1",
"ATable3.2_2",
"ATable3.2_3", 
"ATable3.2_4", 
"ATable3.2_5",

"BTable3.3_1",
"BTable3.3_2",
"BTable3.3_3",
"BTable3.3_4",
"BTable3.3_5", 
"LTable3.3_1", 
"LTable3.3_2",
"LTable3.3_3", 
"LTable3.3_4", 
"LTable3.3_5",
"STable3.3_1", 
"STable3.3_2", 
"STable3.3_3", 
"STable3.3_4", 
"STable3.3_5", 
"ATable3.3_1", 
"ATable3.3_2", 
"ATable3.3_3", 
"ATable3.3_4", 
"ATable3.3_5"
  ),
  fsim = rep(1,80))
}
```

Splitnonsplit test "SPLIT" sinatra sequential vs. parallel testing - not in MS
```{r}
params <- if(HCRtoplot == "SPLIT"){list(
  scendir = c( #nonsplit
    "~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/spawbiotest_oldersinatra2bag/",
    "~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/spawbiotest_oldersinatra2all/",
  
    #split               
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2bag/sim1_10/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2bag/sim11_20/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2bag/sim21_30/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2bag/sim31_40/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2bag/sim41_50/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2all/sim1_10/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2all/sim11_20/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2all/sim21_30/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2all/sim31_40/",
"~/Desktop/FlounderMSE/kw_sims_test/TestingSims/testsims_old/SplittingSimsTest/runnewest50sims26years/split_oldersinatra2all/sim41_50/"
),
  scen.name = c(#1,2,3,4,5,6,7,8
"BNonsplit_bag",
"ANonsplit_all",
"BSplit_bag",
"BSplit_bag",
"BSplit_bag",
"BSplit_bag",
"BSplit_bag",
"ASplit_all",
"ASplit_all",
"ASplit_all",
"ASplit_all",
"ASplit_all"
  ),
  fsim = rep(1,12))
}
```

BBM "BBM" test - not in MS
```{r}
#BBM V2
params <- if(HCRtoplot == "BBMv2"){list(
  scendir = c("~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/1_bag/sim1_10/",
             "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.1/4_all/sim41_50/",
              
             "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/1_bag/sim1_10/",
             "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.2/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.3/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.4/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.5/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.6/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BBM2/Table3.7/4_all/sim41_50/"
              ),
  scen.name = c(
"BTable3_1", "BTable3_2", "BTable3_3", "BTable3_4", "BTable3_5",  "LTable3_1",  "LTable3_2", "LTable3_3", "LTable3_4", "LTable3_5",
"STable3_1", "STable3_2", "STable3_3",  "STable3_4",  "STable3_5",  "ATable3_1",  "ATable3_2", "ATable3_3", "ATable3_4", "ATable3_5",
"BTable3.1_1", "BTable3.1_2", "BTable3.1_3", "BTable3.1_4", "BTable3.1_5", "LTable3.1_1", "LTable3.1_2","LTable3.1_3", "LTable3.1_4","LTable3.1_5",
"STable3.1_1", "STable3.1_2", "STable3.1_3", "STable3.1_4", "STable3.1_5", "ATable3.1_1", "ATable3.1_2","ATable3.1_3", "ATable3.1_4","ATable3.1_5",
"BTable3.2_1","BTable3.2_2", "BTable3.2_3", "BTable3.2_4", "BTable3.2_5", "LTable3.2_1", "LTable3.2_2", "LTable3.2_3", "LTable3.2_4", "LTable3.2_5",
"STable3.2_1", "STable3.2_2", "STable3.2_3", "STable3.2_4", "STable3.2_5", "ATable3.2_1", "ATable3.2_2", "ATable3.2_3", "ATable3.2_4", "ATable3.2_5",
"BTable3.3_1","BTable3.3_2", "BTable3.3_3", "BTable3.3_4", "BTable3.3_5", "LTable3.3_1", "LTable3.3_2", "LTable3.3_3", "LTable3.3_4", "LTable3.3_5",
"STable3.3_1", "STable3.3_2", "STable3.3_3", "STable3.3_4", "STable3.3_5", "ATable3.3_1", "ATable3.3_2", "ATable3.3_3", "ATable3.3_4", "ATable3.3_5",
"BTable3.4_1","BTable3.4_2", "BTable3.4_3", "BTable3.4_4", "BTable3.4_5", "LTable3.4_1", "LTable3.4_2", "LTable3.4_3", "LTable3.4_4", "LTable3.4_5",
"STable3.4_1", "STable3.4_2", "STable3.4_3", "STable3.4_4", "STable3.4_5", "ATable3.4_1", "ATable3.4_2", "ATable3.4_3", "ATable3.4_4", "ATable3.4_5",
"BTable3.5_1","BTable3.5_2", "BTable3.5_3", "BTable3.5_4", "BTable3.5_5", "LTable3.5_1", "LTable3.5_2", "LTable3.5_3", "LTable3.5_4", "LTable3.5_5",
"STable3.5_1", "STable3.5_2", "STable3.5_3", "STable3.5_4", "STable3.5_5", "ATable3.5_1", "ATable3.5_2", "ATable3.5_3", "ATable3.5_4", "ATable3.5_5",
"BTable3.6_1", "BTable3.6_2", "BTable3.6_3", "BTable3.6_4", "BTable3.6_5", "LTable3.6_1", "LTable3.6_2", "LTable3.6_3", "LTable3.6_4", "LTable3.6_5",
"STable3.6_1", "STable3.6_2", "STable3.6_3", "STable3.6_4", "STable3.6_5", "ATable3.6_1", "ATable3.6_2", "ATable3.6_3", "ATable3.6_4", "ATable3.6_5",
"BTable3.7_1", "BTable3.7_2", "BTable3.7_3", "BTable3.7_4", "BTable3.7_5", "LTable3.7_1", "LTable3.7_2", "LTable3.7_3", "LTable3.7_4", "LTable3.7_5",
"STable3.7_1", "STable3.7_2", "STable3.7_3", "STable3.7_4", "STable3.7_5", "ATable3.7_1", "ATable3.7_2", "ATable3.7_3", "ATable3.7_4", "ATable3.7_5"
  ),
  fsim = rep(1,160))
}
```

BRP "BRP" test - not in MS
```{r}
params <- if(HCRtoplot == "BRP"){list(
  scendir = c("~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.1/4_all/sim41_50/",
              
             "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/1_bag/sim1_10/",
             "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.2/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.3/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.4/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.5/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.6/4_all/sim41_50/",
              
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/1_bag/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/1_bag/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/1_bag/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/1_bag/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/1_bag/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/2_length/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/2_length/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/2_length/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/2_length/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/2_length/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/3_season/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/3_season/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/3_season/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/3_season/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/3_season/sim41_50/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/4_all/sim1_10/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/4_all/sim11_20/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/4_all/sim21_30/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/4_all/sim31_40/",
              "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/82824/BRP/Table2.7/4_all/sim41_50/"
              ),
  scen.name = c(
"BTable3_1", "BTable3_2", "BTable3_3", "BTable3_4", "BTable3_5",  "LTable3_1",  "LTable3_2", "LTable3_3", "LTable3_4", "LTable3_5",
"STable3_1", "STable3_2", "STable3_3",  "STable3_4",  "STable3_5",  "ATable3_1",  "ATable3_2", "ATable3_3", "ATable3_4", "ATable3_5",
"BTable3.1_1", "BTable3.1_2", "BTable3.1_3", "BTable3.1_4", "BTable3.1_5", "LTable3.1_1", "LTable3.1_2","LTable3.1_3", "LTable3.1_4","LTable3.1_5",
"STable3.1_1", "STable3.1_2", "STable3.1_3", "STable3.1_4", "STable3.1_5", "ATable3.1_1", "ATable3.1_2","ATable3.1_3", "ATable3.1_4","ATable3.1_5",
"BTable3.2_1","BTable3.2_2", "BTable3.2_3", "BTable3.2_4", "BTable3.2_5", "LTable3.2_1", "LTable3.2_2", "LTable3.2_3", "LTable3.2_4", "LTable3.2_5",
"STable3.2_1", "STable3.2_2", "STable3.2_3", "STable3.2_4", "STable3.2_5", "ATable3.2_1", "ATable3.2_2", "ATable3.2_3", "ATable3.2_4", "ATable3.2_5",
"BTable3.3_1","BTable3.3_2", "BTable3.3_3", "BTable3.3_4", "BTable3.3_5", "LTable3.3_1", "LTable3.3_2", "LTable3.3_3", "LTable3.3_4", "LTable3.3_5",
"STable3.3_1", "STable3.3_2", "STable3.3_3", "STable3.3_4", "STable3.3_5", "ATable3.3_1", "ATable3.3_2", "ATable3.3_3", "ATable3.3_4", "ATable3.3_5",
"BTable3.4_1","BTable3.4_2", "BTable3.4_3", "BTable3.4_4", "BTable3.4_5", "LTable3.4_1", "LTable3.4_2", "LTable3.4_3", "LTable3.4_4", "LTable3.4_5",
"STable3.4_1", "STable3.4_2", "STable3.4_3", "STable3.4_4", "STable3.4_5", "ATable3.4_1", "ATable3.4_2", "ATable3.4_3", "ATable3.4_4", "ATable3.4_5",
"BTable3.5_1","BTable3.5_2", "BTable3.5_3", "BTable3.5_4", "BTable3.5_5", "LTable3.5_1", "LTable3.5_2", "LTable3.5_3", "LTable3.5_4", "LTable3.5_5",
"STable3.5_1", "STable3.5_2", "STable3.5_3", "STable3.5_4", "STable3.5_5", "ATable3.5_1", "ATable3.5_2", "ATable3.5_3", "ATable3.5_4", "ATable3.5_5",
"BTable3.6_1", "BTable3.6_2", "BTable3.6_3", "BTable3.6_4", "BTable3.6_5", "LTable3.6_1", "LTable3.6_2", "LTable3.6_3", "LTable3.6_4", "LTable3.6_5",
"STable3.6_1", "STable3.6_2", "STable3.6_3", "STable3.6_4", "STable3.6_5", "ATable3.6_1", "ATable3.6_2", "ATable3.6_3", "ATable3.6_4", "ATable3.6_5",
"BTable3.7_1", "BTable3.7_2", "BTable3.7_3", "BTable3.7_4", "BTable3.7_5", "LTable3.7_1", "LTable3.7_2", "LTable3.7_3", "LTable3.7_4", "LTable3.7_5",
"STable3.7_1", "STable3.7_2", "STable3.7_3", "STable3.7_4", "STable3.7_5", "ATable3.7_1", "ATable3.7_2", "ATable3.7_3", "ATable3.7_4", "ATable3.7_5"
  ),
  fsim = rep(1,160))
}
```

SNEC input Bin 1 - not in MS
```{r}
params <- if(HCRtoplot == "Bin1"){list( 
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin1/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

SNEC input Bin 3 - not in MS
```{r}
params <- if(HCRtoplot == "Bin3"){list( 
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin3/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

SNEC input Bin 7 - not in MS
```{r}
params <- if(HCRtoplot == "Bin7"){list( #was 102024 before 11/22/24
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/SNECinput/Bin7/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

RDM GAM Bin 1 <- most recent version
```{r}
params <- if(HCRtoplot == "RDMBin1"){list( 
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin1/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

RDM GAM Bin 3 <- most recent version
```{r}
params <- if(HCRtoplot == "RDMBin3"){list( 
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin3/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

RDM GAM Bin 7 <- most recent version
```{r}
params <- if(HCRtoplot == "RDMBin7"){list( #was 102024 before 11/22/24
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/RDMGAM/Bin7/50NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
}
```

Original Runs - not in MS
```{r}
params <- list(
  scendir = c("~/Desktop/FlounderMSE/mafmc-recmeasures/sims/113/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/114/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/115/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/116/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/117/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/118/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/119/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/120/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/121/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/122/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/123/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/124/"
              ),
  scen.name = c("MP 1",
                "MP 2",
                "MP 3",
                "MP 4",
                "MP 5",
                "MP 6",
                "MP 7",
                "MP 8",
                "MP 9",
                "MP 10",
                "MP 11",
                "MP 12"
                ),
  fsim = rep(1,12))

params <- list(
  scendir = c("~/Desktop/FlounderMSE/mafmc-recmeasures/sims/125/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/126/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/127/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/128/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/129/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/130/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/131/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/132/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/133/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/134/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/135/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/136/"
             ),
  scen.name = c("MP 1",
                "MP 2",
                "MP 3",
                "MP 4",
                "MP 5",
                "MP 6",
                "MP 7",
                "MP 8",
                "MP 9",
                "MP 10",
                "MP 11",
                "MP 12"
                ),
  fsim = rep(1,12))

params <- list(
  scendir = c("~/Desktop/FlounderMSE/mafmc-recmeasures/sims/225/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/226/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/227/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/228/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/229/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/230/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/231/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/232/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/233/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/234/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/235/",
              "~/Desktop/FlounderMSE/mafmc-recmeasures/sims/236/"
              ),
  scen.name = c("MP 1",
                "MP 2",
                "MP 3",
                "MP 4",
                "MP 5",
                "MP 6",
                "MP 7",
                "MP 8",
                "MP 9",
                "MP 10",
                "MP 11",
                "MP 12"
                ),
  fsim = rep(1,12))
```

MultiRegUpdate - not in MS
```{r}
params <- list( #was 102024 before 11/22/24
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/NewSinatra/NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))

params <- list( #was 102024 before 11/22/24
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BBM2/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BBM2/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BBM2/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BBM2/sim4_all/",
       
            #BRP
            "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BRP/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BRP/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BRP/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/BRP/sim4_all/",
  
             #PCA 
         "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/PCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/PCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/PCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/PCA/sim4_all/",
  
               #NCA
          "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/NCA/sim1_bag/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/NCA/sim2_length/",
                 "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/NCA/sim3_season/",
                "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/MultiRegUpdateTest/OldSinatra/NCA/sim4_all/"
        ),
  scen.name = c(
"BTable3",
"LTable3",  
"STable3", 
"ATable3",  

"BTable3.1",
"LTable3.1", 
"STable3.1", 
"ATable3.1", 

"BTable3.2",
"LTable3.2", 
"STable3.2",
"ATable3.2",

"BTable3.3",
"LTable3.3", 
"STable3.3", 
"ATable3.3"
  ),
  fsim = rep(1,16))
```

Alternative HCRs - not in MS
```{r}
params <- if(HCRtoplot == "AlternativeBBM"){list( 
  scendir = c( #BBM
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim1_10/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim2_13/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim3_14/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim4_15/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim5_16/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim6_17/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim7_18/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BBM/sim8_19/"
            
        ),
  scen.name = c(
"ATable3.0", 
"ATable3.1",
"ATable3.2",
"ATable3.3",
"ATable3.4",
"ATable3.5",
"ATable3.6",
"ATable3.7"
  ),
  fsim = rep(1,8))
}

params <- if(HCRtoplot == "AlternativeBRP"){list( 
  scendir = c( #BRP
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim1_10/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim2_13/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim3_14/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim4_15/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim5_16/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim6_17/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim7_18/",
    "~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/AlternativeHCRs/BRP/sim8_19/"
            
        ),
  scen.name = c(

"ATable2.0", 
"ATable2.1",
"ATable2.2",
"ATable2.3",
"ATable2.4",
"ATable2.5",
"ATable2.6",
"ATable2.7"
  ),
  fsim = rep(1,8))
}
```

Summarize Output
```{r}
#summarize the output files DONT RERUN THIS UNLESS NEEDED
all_results <- purrr::pmap_dfr(params,read_results, om.name=5)
#View(all_results)
```

Generate time series of metrics 
```{r}
#View(all_results)

#generate time series of metrics
diag_ts <- get_diag_ts(all_results) %>% 
  mutate(nurow = ifelse(type == "spawning biomass" & value == 0,0,1),
         nurow = ifelse(type == "B/Bref" & value == 0,0,nurow)) %>% 
  filter(nurow==1) %>% 
  select(-nurow)
```

Categorize HCR and regulation scenarios
```{r}
#if you don't want to merge with external spreadsheet, and have selected the character name option, run this:

diag_ts <- diag_ts %>%
  mutate(RegType = ifelse( #edits start here
    substr(diag_ts$scenario, 1,1) == "B", "Bag",
    ifelse(
    substr(diag_ts$scenario, 1,1) == "L", "Length",
    ifelse(
    substr(diag_ts$scenario, 1,1) == "S", "Season",
    ifelse(
    substr(diag_ts$scenario, 1,1) == "A", "All", NA  
    )))))

#change what to name them to as needed depending on scenario 
diag_ts$scenario <- ifelse(substr(diag_ts$scenario, 2,8) != "Table3.", "BBM",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.1", "BRP",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.2", "PCA",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.3", "NCA",
                                  ifelse(substr(diag_ts$scenario, 2,9) == "Table3.4", "Table3.4", 
                                    ifelse(substr(diag_ts$scenario, 2,9) == "Table3.5", "Table3.5",
                                    ifelse(substr(diag_ts$scenario, 2,9) == "Table3.6", "Table3.6",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.7", "Table3.7", NA))))))))

```

Stack them if split into 5x10 - no longer used 
```{r}
# run before scenario name change; this honestly might be redundant; results don't change and not treating sims like this anymore 
diag_ts$isim <- ifelse(stringr::str_sub(diag_ts$scenario,-1) == "2",
                                             diag_ts$isim + 10, 
                       ifelse(stringr::str_sub(diag_ts$scenario,-1) == "3",
                                             diag_ts$isim + 20,
                              ifelse(stringr::str_sub(diag_ts$scenario,-1) == "4",
                                             diag_ts$isim + 30,
                                     ifelse(stringr::str_sub(diag_ts$scenario,-1) == "5",
                                             diag_ts$isim + 40, diag_ts$isim))))
```

Label Alternative BBM and BRP - not in MS
```{r}
diag_ts$scenario <- ifelse(substr(diag_ts$scenario, 2,9) == "Table3.0", "BBM",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.1", "BBM_Alternative1",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.2", "BBM_Alternative2",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.3", "BBM_Alternative3",
                                  ifelse(substr(diag_ts$scenario, 2,9) == "Table3.4", "BBM_Alternative4",
                                    ifelse(substr(diag_ts$scenario, 2,9) == "Table3.5", "BBM_Alternative5",
                                    ifelse(substr(diag_ts$scenario, 2,9) == "Table3.6", "BBM_Alternative6",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table3.7", "BBM_Alternative7",
                                          
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table2.0", "BRP",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table2.1", "BRP_Alternative1",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table2.2", "BRP_Alternative2",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table2.3", "BRP_Alternative3",
                                  ifelse(substr(diag_ts$scenario, 2,9) == "Table2.4", "BRP_Alternative4",
                                    ifelse(substr(diag_ts$scenario, 2,9) == "Table2.5", "BRP_Alternative5",
                                    ifelse(substr(diag_ts$scenario, 2,9) == "Table2.6", "BRP_Alternative6",
                                   ifelse(substr(diag_ts$scenario, 2,9) == "Table2.7", "BRP_Alternative7",      
                                          NA))))))))))))))))

 # View(diag_ts)
```

Time series plots - not in MS
```{r}
# # time series plots <- not using this 
 p1 <- diag_ts %>% 
   filter(year != 2019) %>% 
   mutate(type = fct_relevel(type,c("spawning biomass", "total catch"))) %>% 
   filter(type %in% c("B/Bref","F/Fref"),
          scenario %in% c("MP 1","MP 2")) %>% 
   projection.plot()
```

Summarize metrics 
```{r}
 ###### summarizing metrics

metrics <- diag_ts %>% 
  filter(year >= 2036) %>%   #2036 in original to get end of time series
  group_by(om, scenario, isim,
           RegType, #for if using code, remove this if merging from spreadsheet 
           type) %>% 
  summarize(value = case_when(
    type == "F/Fref" ~ mean(value<1, na.rm=TRUE),
    type == "B/Bref" ~ mean(value>0.5, na.rm=TRUE),
    TRUE ~ mean(value, na.rm=TRUE)), .groups = "drop") %>% 
  distinct() %>%  #unsure what is happening, but this helps.
  rename(metric = type,
         mp = scenario) %>% 
  mutate(metric = case_when(
    metric == "F/Fref" ~ "not overfishing",
    metric == "B/Bref" ~ "not overfished",
    TRUE ~ metric))
#View(metrics)

#hcr
median_metrics <- metrics %>% 
  group_by(om, mp, metric) %>% 
  summarize(value = median(value, na.rm=TRUE))

#test <- metrics %>% filter(mp == "BBM", metric == "trophy" )
#median(test$value)

#reg
median_metrics2 <- metrics %>% 
  group_by(om, RegType, metric) %>% 
  summarize(value = median(value, na.rm=TRUE))

#both 
median_metrics3 <- metrics %>% 
  group_by(om, RegType, mp, metric) %>% 
  summarize(value = median(value, na.rm=TRUE))

#################################################

#OR use this to read in a spreadsheet of scenario names and specs
scen_lookup <- read.csv("~/Downloads/scentable2next.csv") %>%
  janitor::clean_names() %>% rename(mp = run_number)
```

State Information - not in MS
```{r}
### state information ###

read_state_results <- function(scendir = "",
                               scen.name="compare",
                               om.name = 1,
                         fsim = 1) {

recoutput2 <- read.table(paste0(scendir, "recoutput2.out"), header = FALSE, skip = 1) #TRUE)
nyrs <- length(unique(recoutput2[,2]))
nsim <- length(unique(recoutput2[,1]))
recoutput2[,1] <- rep(1:nsim, each = 10*nyrs)
names(recoutput2) <- c("isim","year","state","keep_num","rel_num","ntrips","nchoice","change_cs","cost",
                       "keep_one", "mulen_keep","mulen_release","trophy")
state_recoutput <- recoutput2 %>% 
  mutate(scenario = rep(scen.name,nrow(.)),
         isim = isim + fsim -1,
         om = rep(om.name,nrow(.)))

return(state_recoutput)
}

#how it originally was
get_state_ts <- function(results) {
  
  diag_ts <- results %>% 
    mutate(#keep_to_rel = keep_num/release_num,
           change_cs = change_cs*-1,
           "kept per trip" = 1000*keep_num/ntrips,
           "rel per trip" = 1000*rel_num/ntrips,
           #"F/Fref" = frate/fmsy,
           #"B/Bref" = biomass/bmsy,
           "expense" = cost,
           cs_per_trip = change_cs/ntrips,
           #rec_removals = keep_wt + release_wt,
           keep_one = keep_one/ntrips)  %>% 
    select(scenario, isim, state, year, 
           #biomass, 
           #totcat_wt, 
           #rec_removals, 
           #keep_to_rel, 
           "kept per trip", #"F/Fref", "B/Bref",
           "rel per trip", 
           mulen_keep,
           mulen_release,
           trophy,
           expense,
           change_cs,
           ntrips,
           keep_one,
           cs_per_trip,
           #"kept:released"
           #prop_female
    ) %>% 
    # rename("spawning biomass" = biomass,
    #        "total catch" = totcat_wt,
    #        "kept:released" = keep_to_rel) %>% 
    pivot_longer(cols=c(#"spawning biomass","total catch","kept:released", 
                        "kept per trip", 
                        "rel per trip",
                        #"F/Fref", "B/Bref",
                        #rec_removals,
                        mulen_keep,
                        mulen_release,
                        trophy,
                        expense,
                        change_cs,
                        ntrips,
                        keep_one,
                        cs_per_trip,
                        #"kept:released"
                        #prop_female
    ),names_to = "type", values_to = "value") %>% 
    I()
  return(diag_ts)
}

#generate time series of state metrics
state_results <- purrr::pmap_dfr(params,read_state_results)

state_metrics <- get_state_ts(state_results) %>% 
  filter(state!=1) %>% 
  # mutate(nurow = ifelse(type == "spawning biomass" & value == 0,0,1),
  #        nurow = ifelse(type == "B/Bref" & value == 0,0,nurow)) %>% 
  # filter(nurow==1) %>% 
  # select(-nurow)
  filter(year >= 2036) %>%   #2036 in original
  group_by(scenario, type, isim, state
           ) %>% 
  summarize(#value = case_when(
    # type == "F/Fref" ~ mean(value<1, na.rm=TRUE),
    # type == "B/Bref" ~ mean(value>0.5, na.rm=TRUE),
    #TRUE 
    value = mean(value, na.rm=TRUE), .groups = "drop") %>% 
  distinct() %>%  #unsure what is happening, but this helps.
  rename(metric = type,
         mp = scenario) #%>% 
  # mutate(metric = case_when(
  #   metric == "F/Fref" ~ "not overfishing",
  #   metric == "B/Bref" ~ "not overfished",
  #   TRUE ~ metric))

 state_metrics <- state_metrics %>% mutate(RegType = ifelse( #edits start here
    substr(state_metrics$mp, 1,1) == "B", "Bag",
    ifelse(
    substr(state_metrics$mp, 1,1) == "L", "Length",
    ifelse(
    substr(state_metrics$mp, 1,1) == "S", "Season",
    ifelse(
    substr(state_metrics$mp, 1,1) == "A", "All", NA  
    ))))) 
 
 state_metrics$mp <- ifelse(substr(state_metrics$mp, 2,8) != "Table3.", "BBM",
                                   ifelse(substr(state_metrics$mp, 2,9) == "Table3.1", "BRP",
                                   ifelse(substr(state_metrics$mp, 2,9) == "Table3.2", "PCA",
                                   ifelse(substr(state_metrics$mp, 2,9) == "Table3.3", "NCA",
                                  ifelse(substr(state_metrics$mp, 2,9) == "Table3.4", "Table3.4",
                                    ifelse(substr(state_metrics$mp, 2,9) == "Table3.5", "Table3.5",
                                    ifelse(substr(state_metrics$mp, 2,9) == "Table3.6", "Table3.6",
                                   ifelse(substr(state_metrics$mp, 2,9) == "Table3.7", "Table3.7", NA))))))))

 #probably not necessary -> same code for splitsims 
state_metrics$isim <- ifelse(stringr::str_sub(state_metrics$mp,-1) == "2",
                                             state_metrics$isim + 10, 
                       ifelse(stringr::str_sub(state_metrics$mp,-1) == "3",
                                             state_metrics$isim + 20,
                              ifelse(stringr::str_sub(state_metrics$mp,-1) == "4",
                                             state_metrics$isim + 30,
                                     ifelse(stringr::str_sub(state_metrics$mp,-1) == "5",
                                             state_metrics$isim + 40, state_metrics$isim))))


state_metrics$om <- 5.  #dummy value for 2024 rec measures modeling

#state metrics plotting code from 2022 MSE

#harvest control rules
do_state_bp <- function(state_metrics = NULL) {
  title_metric <- state_metrics$metric[1]
  state_bp <- state_metrics %>% 
    #filter(metric %in% c("change_cs")) %>%  #c("kept per trip")) %>% 
  ggplot() +
  aes(x = mp, y = value, fill = mp) +
  geom_boxplot(outlier.shape=NA) +
  scale_fill_brewer(type = "qual", palette = 2) +
  facet_wrap(~state, scale = "free_y") +
  #facet_wrap(~metric, scale = "free_y") +
  ylab("") +
  xlab("") +
  theme_bw() +
  #ylim(0,5e+06) +
  theme(legend.position = "bottom",
        axis.text.x = element_blank()) +
  labs(fill = "",
       title = title_metric) + #kept per trip") +
  guides(fill = guide_legend(nrow = 1))
  return(state_bp)
}

state_bp <- state_metrics %>% 
#  filter(om == 1) %>% 
   mutate(scenario = fct_recode(mp,
                   "Percent Change Approach" = "PCA",
                   "Biological Reference Point" = "BRP", 
                   "Biomass Based Matrix" = "BBM", 
                   "No Change Approach" = "NCA")) %>% 
  nest_by(metric,.keep = TRUE) %>% 
  mutate(bp = list(do_state_bp(data)))

for (i in seq_along(state_bp$metric)){
  tmp <- state_bp$bp[[i]]
  cat("####", tmp$data$metric[1], " \n")
  print(tmp)
  cat(" \n\n")
}

#regulations
do_state_bp_2 <- function(state_metrics = NULL) {
  title_metric <- state_metrics$metric[1]
  state_bp <- state_metrics %>% 
    #filter(metric %in% c("change_cs")) %>%  #c("kept per trip")) %>% 
  ggplot() +
  aes(x = RegType, y = value, fill = RegType) +
  geom_boxplot(outlier.shape=NA) +
 # scale_fill_brewer(type = "qual", palette = 1) +
  scale_fill_manual(values = c("#66a61e", "#e6ab02", "#a6761d", "#d95f02")) + 
  facet_wrap(~state, scale = "free_y") +
  #facet_wrap(~metric, scale = "free_y") +
  ylab("") +
  xlab("") +
  theme_bw() +
  #ylim(0,5e+06) +
  theme(legend.position = "bottom",
        axis.text.x = element_blank()) +
  labs(fill = "",
       title = title_metric) + #kept per trip") +
  guides(fill = guide_legend(nrow = 1))
  return(state_bp)
}

state_bp <- state_metrics %>% 
#  filter(om == 1) %>% 
   mutate(scenario = fct_recode(RegType,
                   "Percent Change Approach" = "All",
                   "Biological Reference Point" = "Bag", 
                   "Biomass Based Matrix" = "Length", 
                   "No Change Approach" = "Season")) %>% 
  nest_by(metric,.keep = TRUE) %>% 
  mutate(bp = list(do_state_bp_2(data)))

for (i in seq_along(state_bp$metric)){
  tmp <- state_bp$bp[[i]]
  cat("####", tmp$data$metric[1], " \n")
  print(tmp)
  cat(" \n\n")
}

#seems like a lot of the performnace metrics used in the boxplot are coastwide (e.g. not sure how to do F/FMSY for each state without creating an extremely complicated unrealistic pseudo-assessment) and the state-specific ones are ones taken from RDM output 
```

Save Files - only BBMSY ones used in MS
```{r}
#saveRDS(metrics,"~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/101624/baseregsposter.rds")
#saveRDS(median_metrics,"~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/101624/median_baseregsposter.rds")
#saveRDS(state_metrics,"~/Desktop/FlounderMSE/kw_sims_test/MSE_boxplots/82824/full_state_metricsBBMv2_#regchanged.rds")

#metrics <- readRDS("all_results_distrib.rds")
#median_metrics <- readRDS("all_results_medians.rds")
#metrics <- readRDS("~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/101624/baseregsposter.rds")
#median_metrics <- readRDS("~/Desktop/FlounderMSE/kw_sims_test/UnityOutput/101624/median_baseregsposter.rds")

#state_metrics <- readRDS("~/Desktop/FlounderMSE/kw_sims_test/MSE_boxplots/82824/full_state_metricsBBMv2_regchanged.rds") %>%
 # mutate(state = fct_relevel(state,
 #                            c("MA","RI","CT","NY","NJ","DE","MD","VA","NC")))

#state_medians <- state_metrics %>% 
#  group_by(om, mp, state, metric) %>% 
#  summarize(value = median(value, na.rm=TRUE)) %>% 
#  I()

#metrics3 <- rbind(metrics, metrics1)
#View(metrics3)

# save dataframes for startbbmsy scenarios; need to run each HCRtoplot scenario and save object from each here  

if(HCRtoplot == "RDMBin1"){
Bin1 <- median_metrics %>% mutate(StartBBMSY = 2)
Bin1_reg <- median_metrics2 %>% mutate(StartBBMSY = 2)
} else 
if(HCRtoplot == "RDMBin3"){
Bin3 <- median_metrics %>% mutate(StartBBMSY = 1)
Bin3_reg <- median_metrics2 %>% mutate(StartBBMSY = 1)
} else 
  if(HCRtoplot == "RDMBin7"){
Bin7 <- median_metrics %>% mutate(StartBBMSY = 0.3)
Bin7_reg <- median_metrics2 %>% mutate(StartBBMSY = 0.3)
  }
startbbmsydata_hcr <- rbind(Bin1, Bin3, Bin7)
startbbmsydata_reg <- rbind(Bin1_reg, Bin3_reg, Bin7_reg)

#saveRDS(startbbmsydata_hcr, "~/Desktop/FlounderMSE/median_metrics_rdsfiles/version2_seed/startbbmsydata_hcr.rds")
#saveRDS(startbbmsydata_reg, "~/Desktop/FlounderMSE/median_metrics_rdsfiles/version2_seed/startbbmsydata_reg.rds")
```

Prepare table for plotting
```{r}
#prepare table for plotting 
metrics2 <- metrics %>% 
 # left_join(scen_lookup) %>% #include this if using sheet
  mutate(om = factor(om),
      #   om = fct_recode(om, "Base" = "1","MRIP Bias" = "2","Shift" = "3"),
         mp2 = fct_recode(factor(mp), #put hcr if using sheet, mp if using code in here
                       #   "BNonsplit_bag" = "BNonsplit_bag",
                       #   "BSplit_bag" = "BSplit_bag",
                       #    "ANonsplit_all" = "ANonsplit_all",
                       #   "ASplit_all" = "ASplit_all",
                          "Percent Change Approach" = "PCA",
                          "Biological Ref. Point" = "BRP",
                          "Biomass Matrix" = "BBM",
                          "No Change (RHL as target)" = "NCA",
                          #   "Table3" = "Table3",
                       #  "Table3.1" = "Table3.1",
                       #  "Table3.2" = "Table3.2",
                       #  "Table3.3" = "Table3.3",
                      #   "Table3.4" = "Table3.4",
                      #  "Table3.5" = "Table3.5",
                     #    "Table3.6" = "Table3.6",
                     #    "Table3.7" = "Table3.7"
                        ),
         mp3 = fct_collapse(factor(RegType), #reg_to_change if sheet, RegType if not
                     "Bag" = "Bag",
                      "Len" = "Length",
                         "Seas" = "Season",
                      "All" = "All"
                     ),
        mp3 = fct_relevel(mp3, "Bag", "Len", "Seas", "All"),
         #value = ifelse(metric == "exp_keep", 0.39*value, value),
         metric = factor(metric, levels = c("rel per trip",
                                            "spawning biomass", 
                                            "ntrips", 
                                            "trophy", 
                                            "not overfishing",
                                            "not overfished",
                                            "kept per trip", 
                                            "keep_one",
                                            "prop_female",
                                            "kept:released",
                                            "cs_per_trip",
                                            "rec_removals",
                                            "keep_one_range",
                                            "change_cs"#,
                                            #"exp_keep"
                                            #"gdp_mp1"
                                            ))) 

#View(metrics2)
```

Prepare table for plotting alternative HCRs - not in MS
```{r}

#ALTERNATIVE HCRs

metrics2 <- metrics %>% 
 # left_join(scen_lookup) %>% #include this if using sheet
  mutate(om = factor(om),
      #   om = fct_recode(om, "Base" = "1","MRIP Bias" = "2","Shift" = "3"),
         mp2 = fct_recode(factor(mp), #put hcr if using sheet, mp if using code in here
                       #   "BNonsplit_bag" = "BNonsplit_bag",
                       #   "BSplit_bag" = "BSplit_bag",
                       #    "ANonsplit_all" = "ANonsplit_all",
                       #   "ASplit_all" = "ASplit_all",
                       #   "Percent Change Approach" = "PCA",
                       #   "Biological Ref. Point" = "BRP",
                       #   "Biomass Matrix" = "BBM",
                       #   "No Change (RHL as target)" = "NCA",
                       #   "BBM" = "BBM",
                       #   "Alt 1" = "BBM_Alternative1",
                       #   "Alt 2" = "BBM_Alternative2",
                       #   "Alt 3" = "BBM_Alternative3",
                       #   "Alt 4" = "BBM_Alternative4",
                       #   "Alt 5" = "BBM_Alternative5",
                       #   "Alt 6" = "BBM_Alternative6",
                       #   "Alt 7" = "BBM_Alternative7"#,
                          "BRP" = "BRP",
                          "Alt 1" = "BRP_Alternative1",
                          "Alt 2" = "BRP_Alternative2",
                          "Alt 3" = "BRP_Alternative3",
                          "Alt 4" = "BRP_Alternative4",
                          "Alt 5" = "BRP_Alternative5",
                          "Alt 6" = "BRP_Alternative6",
                          "Alt 7" = "BRP_Alternative7"
                        ),
         mp3 = fct_collapse(factor(RegType), #reg_to_change if sheet, RegType if not
                  #   "Bag" = "Bag",
                  #    "Len" = "Length",
                   #      "Seas" = "Season",
                      "All" = "All"
                     ),
        mp3 = fct_relevel(mp3, #"Bag", "Len", "Seas",
                          "All"),
         #value = ifelse(metric == "exp_keep", 0.39*value, value),
         metric = factor(metric, levels = c("keep_one",
                                            "kept per trip", #_mp1",
                                            "cs_per_trip",
                                            "trophy",
                                            #"keep_one_mp1",
                                            "keep_one_range", #_mp1",
                                            "kept:released", #_mp1",
                                            #"kept:rel_range", #_mp1",
                                            "not overfished",
                                            "not overfishing",
                                            "spawning biomass", #_mp1",
                                            "rel per trip", #_mp1",
                                            "rec_removals", #_mp1",
                                            "prop_female",
                                            "ntrips", #_mp1",
                                            "change_cs"#,
                                            #"exp_keep"
                                            #"gdp_mp1"
                                            ))) 
```

Boxplot
```{r}
# add boxplots
#y_limits <- data.frame(
#  metric = c("keep_one","kept per trip","cs_per_trip","trophy","kept:released","not overfished",
 # "not overfishing","spawning biomass","rel per trip","rec_removals","prop_female",
 # "ntrips"),
 # ymin = c(0,0,-20, 0,0,0,0,0,0,0,0,0),
 # ymax = c(0.4, 0.75, 20, 0.075, 0.25, 1, 1, 6000, 5, 15000, 0.75, 1.3e7)
#)
#metrics2 <- metrics2 %>% left_join(y_limits, by = "metric") 

#normal boxplot
p2 <- metrics2 %>% 
  drop_na() %>% 
  filter(!(metric %in% c("change_cs","keep_one_range"))) %>% 
 # filter(metric %in% c("keep_one", "not overfishing", "ntrips", "trophy")) %>%
  droplevels() %>% 
  #filter(om == "Base") %>% 
  ggplot() +
  aes(x = mp3, y = value, fill = mp2) +
  #aes(x = mp3, y = value, fill = mp3) +
  geom_boxplot(outlier.shape=NA) +
  scale_fill_brewer(type = "qual", palette = 2) +
  facet_wrap(~metric, scale = "free_y",drop = F) +
 #  coord_cartesian(ylim = c(min(metrics2$ymin), max(metrics2$ymax))) + 
  ylab("Performance Metric Value") +
  xlab("Regulation to Change") +
  theme_bw() +
  theme(legend.position = "bottom") + #,
        #axis.text.x = element_blank()) +
  labs(fill = "HCR") + #,
       #subtitle = "Base scenario") +
  guides(fill = guide_legend(nrow = 1))
# add table summaries
#ggsave("~/Desktop/FlounderMSE/ManuscriptPrep/Draft3Figures_coast/boxplot-metrics1bmsy.png",p2,width=9,height=6)
#ggsave("~/Desktop/FlounderMSE/ManuscriptPrep/Draft3Figures_coast/boxplot-metrics2bmsy.png",p2,width=9,height=6)
#ggsave("~/Desktop/FlounderMSE/ManuscriptPrep/Draft3Figures_coast/boxplot-metrics03bmsy.png",p2,width=9,height=6)
p2
```

Boxplot with plot window lettering - not in MS
```{r}
library(ggtext)

#add column sorting by letter
p2 <- metrics2 %>% 
  drop_na() %>% 
  filter(!(metric %in% c("change_cs","keep_one_range"))) %>% 
 # filter(metric %in% c("keep_one", "not overfishing", "ntrips", "trophy")) %>%
  droplevels() %>% 
   mutate(letter = LETTERS[as.integer(factor(metric))]) 

#for adding label to strip 
newlabel <- p2 %>% 
  distinct(metric, letter) %>%
  mutate(label = paste0("<b>", letter,"</b> ", metric)) %>%
  select(metric, label) %>%
  tibble::deframe()

p3 <- p2 %>% 
  ggplot() +
  aes(x = mp3, y = value, fill = mp2) +
 # aes(x = mp2, y = value, fill = mp2) +
  geom_boxplot(outlier.shape=NA) +
  scale_fill_brewer(type = "qual", palette = 2) +
  facet_wrap(~metric, scale = "free_y",drop = F, #+
 labeller = labeller(metric = newlabel)) +
  #this geom_text if not using the labeler 
  #geom_text(
    #data =  metrics3 %>% distinct(metric, letter),
    #aes(label = letter),
    #x = -Inf, y = Inf, hjust = -0.5, vjust = 1.5, size = 3,
    #inherit.aes = FALSE
  #) +
 #  coord_cartesian(ylim = c(min(metrics2$ymin), max(metrics2$ymax))) + 
  ylab("Performance Metric Value") +
  xlab("Regulation to Change") +
  theme_bw() +
        #axis.text.x = element_blank()) +
  theme(legend.position = "bottom",
        strip.text = element_markdown()) + 
  labs(fill = "HCR") + #,
       #subtitle = "Base scenario") +
  guides(fill = guide_legend(nrow = 1))
# add table summaries
#ggsave("boxplot-metrics.png",p2,width=8,height=8)
#ggsave("boxplot-metrics-om2.png",p2,width=8,height=8)
#ggsave("boxplot-metrics-om3.png",p2,width=8,height=8)
#ggsave("boxplot-metrics.png",p2,width=9,height=6)
#ggsave("boxplot-metrics_estF.png",p2,width=9,height=6)
p3
```

Radar Plots

All mp/reg on same plot:
```{r}

#HCR
p3 <- median_metrics %>%  
   mutate(om = factor(om), 
        om = fct_recode(om, "Base" = "5")) %>%#,"MRIP Bias" = "2","Shift" = "3")) %>%
  filter(om == "Base") %>%
   mutate(mp = factor(mp), mp = fct_recode(mp, 
                   "BBM" = "BBM",
                          "BRP" = "BRP", 
                          "NCA" = "NCA",
                          "PCA" = "PCA")
          ) %>% 
   #filter(!metric %in% c("change_cs", "cs_per_trip")) %>%  -->
   #filter(!metric %in% c("expense","cs_per_trip","total catch")) %>%  -->
   filter(metric %in% c("kept:released", "kept per trip", "not overfished", "not overfishing",  "keep_one", "trophy")) %>%  
   do_small_radar_plot()

#REG
p3 <- median_metrics2 %>% rename(mp = RegType) %>% 
   mutate(om = factor(om), 
        om = fct_recode(om, "Base" = "5")) %>%#,"MRIP Bias" = "2","Shift" = "3")) %>%
  filter(om == "Base") %>%
   mutate(mp = factor(mp), mp = fct_recode(mp, 
                   "All" = "All",
                          "Bag" = "Bag",  
                          "Season" = "Season",
                          "Length" = "Length")
          ) %>%
   #filter(!metric %in% c("change_cs", "cs_per_trip")) %>%  -->
   #filter(!metric %in% c("expense","cs_per_trip","total catch")) %>%  -->
   filter(metric %in% c("kept:released", "kept per trip", "not overfished", "not overfishing",  "keep_one", "trophy")) %>%  
   do_small_radar_plot()

```

Radar plot with 1 at a time - not in MS
```{r}
#edited radarplot function code for 1 at a time 

#metrics <- p3
do_small_radar_plot_prep <- function(metrics) {
  # metrics is a dataframe of metrics, expecting columns
  # metrics <- tibble(metric = rep(letters[1:5],each=3),
  #                   value = runif(15),
  #                   mp = as.character(rep(1:3,5)))
  # # metric 
  # # value
  # # mp (management procedure)
  summaries <- metrics %>% 
    group_by(metric) %>% 
    summarize(min = min(value, na.rm = TRUE),
              max = max(value, na.rm = TRUE)) %>% 
    #pivot_longer(cols = c(2:3),names_to = "mp",
    #             values_to = "value") %>% 
    #pivot_wider(names_from = metric, values_from = value) %>% 
    #arrange(desc(mp)) %>% 
    I()
  #summaries  
  nmetrics <- length(unique(metrics$metric))
  nmp <- length(unique(metrics$mp))
  
  d <- metrics %>% 
    group_by(mp) %>% 
    left_join(summaries) %>% 
    mutate(value = value/(max + 1e-08)) %>% 
    select(mp, metric, value) %>% 
    pivot_wider(names_from = metric, values_from = value) %>% 
    ungroup()
  
  bounds <- tibble(mp = c("max","min"),
                   
                   #"total catch" = c(1,0),
                   "kept:released" = c(1,0),
                   "kept per trip" = c(1,0),
                   "not overfishing" = c(1,0),
                   "not overfished" = c(1,0),
                   "spawning biomass" = c(1,0),
                   "rel per trip" = c(1,0), #not sure why this one doesn't work 
                   #"cs_per_trip" = c(1,0),
                   #"change_cs" = c(1,0),
                   #"mulen_keep" = c(1,0),
                   #"mulen_release" = c(1,0),
                   #"trophy" = c(1,0),
                   #"rec_removals" = c(1,0),
                   "keep_one" = c(1,0)) #,
                   #"prop_female" = c(1,0),
                   #"ntrips" = c(1,0)) #,
  #filter(metric %in% c("change_cs", "kept per trip", "kept:released", "not overfished", "not overfishing")) %>% 
  #d = c(1,0),
  #e = c(1,0))
        
  dd <- bounds %>% 
    bind_rows(d)
  
   colors_fill2<-c(alpha("#000000",0.1),
                  alpha("#E69F00",0.1),
                  alpha("#56B4E9",0.1),
                  alpha("#009E73",0.1),
                  alpha("#F0E442",0.1),
                  alpha("#E69F00",0.1),
                  alpha("#56B4E9",0.1),
                  alpha("#009E73",0.1))
  colors_line2<-c(alpha("#000000",0.9),
                  alpha("#E69F00",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#009E73",0.9),
                  alpha("#F0E442",0.9),
                  alpha("#E69F00",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#009E73",0.9))
  colors_line2<-c(alpha("#1b9e77",0.9),
                  alpha("#d95f02",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#dc14cf",0.9),
                  #alpha("#009E73",0.9),
                  alpha("#F0E442",0.9),
                  alpha("#E69F00",0.9),
                  alpha("#56B4E9",0.9),
                  alpha("#009E73",0.9))
  
  colors_fill2<-c(alpha("#1b9e77",0.1),
                  alpha("#d95f02",0.1),
                  alpha("#7570b3",0.1),
                  alpha("#e7298a",0.1),
                  alpha("#66a61e",0.1),
                  alpha("#e6ab02",0.1),
                  alpha("#a6761d",0.1),
                  alpha("#d95f02",0.1))
  
  colors_line2<-c(alpha("#1b9e77",0.9),
                  alpha("#d95f02",0.9),
                  alpha("#7570b3",0.9),
                  alpha("#e7298a",0.9),
                  alpha("#66a61e",0.9),
                  alpha("#e6ab02",0.9),
                  alpha("#a6761d",0.9),
                  alpha("#d95f02",0.9))
  
  #colorblind
  radarchart(dd[,-1],seg=5,pcol=colors_line2,
             pfcol=colors_fill2,plwd=2,
             vlabels=names(dd)[-1], vlcex=0.8,
             plty=c(rep(1,7),rep(2,7)),
             pdensity=0)
  rows<<-rownames(dd[-c(1,2),])
  colors_line<<-colors_line2
  legend("bottomright",inset=0,title ="",title.adj = 0.2,
         legend=unique(d$mp),
         pch=16,
         col=colors_line2[1:nmp],
         lty=1, cex=0.8, bty= 'n', y.intersp=1)
}

#FOR PLOTTING SEPARATELY  (run code in next chunk first)
p3 <- median_metrics %>%  
   mutate(om = factor(om), 
        om = fct_recode(om, "Base" = "5","MRIP Bias" = "2","Shift" = "3")) %>%
  filter(om == "Base") %>%
   mutate(mp = fct_recode(mp, 
                   "NCA" = "NCA",
                          "PCA" = "PCA", 
                          "BRP" = "BRP",
                          "BBM" = "BBM")
                   ) %>%  
   #filter(!metric %in% c("change_cs", "cs_per_trip")) %>%  -->
   #filter(!metric %in% c("expense","cs_per_trip","total catch")) %>%  -->
   filter(metric %in% c("kept per trip", "kept:released", "not overfished", "not overfishing",  "keep_one", "spawning biomass", "rel per trip")) %>%  
   do_small_radar_plot_prep()

#BBM
p3_BBM <- p3[1:3,] 
radarchart(p3_BBM[,-1],
           seg=5,
           pcol=colors_line2,
           pfcol=colors_fill2,
           plwd=2,
           vlabels=names(p3_BBM)[-1],
           vlcex=0.8,
           title = "Biomass-Based Matrix", cex.main = 0.9)
           #   ,
           #  plty=c(rep(1,7),rep(2,7)),
           #  pdensity=0)
  #rows<<-rownames(p3_BBM[-c(1,2),])
  #colors_line<<-colors_line2

#BRP
p3_BRP <- p3[c(1,2,4),] 
radarchart(p3_BRP[,-1],
           seg=5,
           pcol=colors_line2[2],
           pfcol=colors_fill2[2],
           plwd=2,
           vlabels=names(p3_BRP)[-1],
           vlcex=0.8,
           title = "Biological Reference Point", cex.main = 0.9)
           #   ,
           #  plty=c(rep(1,7),rep(2,7)),
           #  pdensity=0)
  #rows<<-rownames(p3_BBM[-c(1,2),])
  #colors_line<<-colors_line2

#PCA
p3_PCA <- p3[c(1,2,6),] 
radarchart(p3_PCA[,-1],
           seg=5,
           pcol=colors_line2[4],
           pfcol=colors_fill2[4],
           plwd=2,
           vlabels=names(p3_PCA)[-1],
           vlcex=0.8,
           title = "Percent Change Approach", cex.main = 0.9)
           #   ,
           #  plty=c(rep(1,7),rep(2,7)),
           #  pdensity=0)
  #rows<<-rownames(p3_BBM[-c(1,2),])
  #colors_line<<-colors_line2

#NCA
p3_NCA <- p3[c(1,2,5),] 
radarchart(p3_NCA[,-1],
           seg=5,
           pcol=colors_line2[3],
           pfcol=colors_fill2[3],
           plwd=2,
           vlabels=names(p3_NCA)[-1],
           vlcex=0.8,
           title = "No Change Approach", cex.main = 0.9)
           #   ,
  
  #don't need this for plotting one at a time
  legend("bottomright",inset=0,title ="",title.adj = 0.4,
         legend=unique(d$mp),
         pch=16,
         col=colors_line2[1:nmp],
         lty=1, cex=0.8, bty= 'n', y.intersp=1)
  
```

Newer Runs RDM vs GAM plots - not in MS
```{r}
#for processing RDM_ssbscramble script gam prediction testing 

#from ########## FORM PREDICTIONS OF OUTPUT FILE ############### section

#make sure state != 1 in first chunk of this script (if you scroll to top and control F "state" it will be the second thing)

all_results_test <- all_results %>% filter(
  #scenario %in% c("BTable3", "LTable3", "STable3", "ATable3"), 
  year != 2019)

all_results_test <- all_results_test %>%
  mutate(RegType = ifelse( #edits start here
    substr(all_results_test$scenario, 1,1) == "B", "Bag",
    ifelse(
      substr(all_results_test$scenario, 1,1) == "L", "Length",
      ifelse(
        substr(all_results_test$scenario, 1,1) == "S", "Season",
        ifelse(
          substr(all_results_test$scenario, 1,1) == "A", "All", NA  
        )))))

all_results_test$scenario <- ifelse(substr(all_results_test$scenario, 2,8) != "Table3.", "BBM",
                           ifelse(substr(all_results_test$scenario, 2,9) == "Table3.1", "BRP",
                                  ifelse(substr(all_results_test$scenario, 2,9) == "Table3.2", "PCA",
                                         ifelse(substr(all_results_test$scenario, 2,9) == "Table3.3", "NCA",
                                                ifelse(substr(all_results_test$scenario, 2,9) == "Table3.4", "Table3.4",
                                                       ifelse(substr(all_results_test$scenario, 2,9) == "Table3.5", "Table3.5",
                                                              ifelse(substr(all_results_test$scenario, 2,9) == "Table3.6", "Table3.6",
                                                                     ifelse(substr(all_results_test$scenario, 2,9) == "Table3.7", "Table3.7", NA))))))))

#predict data frame: same time step

predict_frame <- data.frame(Bag = all_results_test$bag,
                            MinLen = all_results_test$minlen, 
                            SeasonLen = all_results_test$seaslen,
                            state = all_results_test$state,
                            n_keep = all_results_test$n_keep,
                       #     SSB_1 = all_results_test$SSB, #rbctrack
                            SSB = all_results_test$biomass #spawbio
                            )# %>% mutate(Scen = "2BBMSY")

gamfit2 <- predict.gam(g1.1state, newdata = predict_frame, type = "response" , se.fit = TRUE)
#gamfit2 <- predict.gam(g1, newdata = predict_frame, type = "response" , se.fit = TRUE)

#for plotting (includes n_keep)
predict_frame_gg <- data.frame(Bag = all_results_test$bag,
                            MinLen = all_results_test$minlen, 
                            SeasonLen = all_results_test$seaslen,
                            state = all_results_test$state,
                            n_keep = all_results_test$n_keep,
                         #  SSB_1 = all_results_test$SSB, #rbctrack 
                            SSB = all_results_test$biomass, #spawbio
                         #  exp_keep = exp(gamfit2$fit) + sqrt(g1$sig2)
                         exp_keep = gamfit2$fit, #if doing other two
                         hcr = all_results_test$scenario,
                         reg = all_results_test$RegType) 

#plot by state
predict_frame_gg %>%
  #filter(reg == "All") %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = SSB) + #scaler?
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from GAM"
  ) +
  facet_wrap(~SeasonLen) +
  xlim(0,1e+07) + #2e7
  ylim(0,1e+07) +
  NULL

#sum into coastwide
all_results <- predict_frame_gg
all_results_summed <- all_results %>% 
  mutate(group = rep(1:ceiling(n()/9), each = 9)[1:n()]) %>%
  group_by(group) %>%
  summarise(n_keep = sum(n_keep, na.rm = TRUE), exp_keep = sum(exp_keep, na.rm = TRUE))

all_results <- all_results %>% filter(state == "CT") %>% 
  select( Bag, MinLen, SeasonLen, SSB, hcr, reg) %>%
  mutate(n_keep = all_results_summed$n_keep, exp_keep = all_results_summed$exp_keep)
all_results$biomass <- all_results$SSB

#plot coastwide; start here if plotting directly from MSE output 

#total
all_results %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = biomass
      ) + #scaler?
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "Realized harvest from RDM",
    x = "Expected harvest from GAM"
  ) + 
  ggtitle("GAM Predictions of MSE Harvest") + 
 # facet_wrap(~state) +
  xlim(0,8e+07) + #2e7
  ylim(0,8e+07) +
  NULL
#View(all_results)

plot(all_results$n_keep~all_results$exp_keep, xlim = c(0,2e7), ylim = c(0,2e7))

#facet by different regulations 

#bag
ggplot(all_results, mapping=aes(y = n_keep, x = exp_keep, col = Bag)) + 
  geom_point() + 
  xlim(0,2e7) +
  ylim(0,2e7) +
  geom_abline(slope = 1, intercept = 0) + 
  facet_wrap(~Bag, scales = "free_y")

#minlen
ggplot(all_results, mapping=aes(y = n_keep, x = exp_keep, col = MinLen)) + 
  geom_point() + 
  xlim(0,2e7) +
  ylim(0,2e7) +
  geom_abline(slope = 1, intercept = 0) + 
  facet_wrap(~MinLen, scales = "free_y")

#seaslen
ggplot(all_results, mapping=aes(y = n_keep, x = exp_keep, col = SeasonLen)) + 
  geom_point() + 
  xlim(0,2e7) +
  ylim(0,2e7) +
  geom_abline(slope = 1, intercept = 0) + 
  facet_wrap(~SeasonLen, scales = "free_y")

#hist(all_results$bag)
#hist(all_results$seaslen)
#hist(all_results$minlen)

#ssb -> too many biomass values to facet by

#very small 
#nrow(all_results %>% filter(biomass < 20000)) #2061

nrow(all_results %>% filter(biomass < 20000))

all_results %>% filter(biomass < 20000) %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from GAM"
  ) +
  #facet_wrap(~bag) +
  xlim(0,3e+07) +
  ylim(0,3e+07) +
  NULL

#small
#nrow(all_results %>% filter(biomass < 30000 & biomass > 20000)) #9270
nrow(all_results %>% filter(biomass < 30000 & biomass > 20000))

all_results %>% filter(biomass < 30000 & biomass > 20000) %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from GAM"
  ) +
  #facet_wrap(~bag) +
  xlim(0,3e+07) +
  ylim(0,3e+07) +
  NULL

#med
#nrow(all_results %>% filter(biomass > 30000 & biomass < 50000)) #8430
nrow(all_results %>% filter(biomass > 30000 & biomass < 50000))

all_results %>% filter(biomass > 30000 & biomass < 50000) %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from GAM"
  ) +
  #facet_wrap(~bag) +
  xlim(0,3e+07) +
  ylim(0,3e+07) +
  NULL

#large 
#nrow(all_results %>% filter(biomass > 50000 & biomass < 100000)) #1759
nrow(all_results %>% filter(biomass > 50000 & biomass < 100000))

all_results %>% filter(biomass > 50000 & biomass < 100000) %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from GAM"
  ) +
  #facet_wrap(~bag) +
  xlim(0,3e+07) +
  ylim(0,3e+07) +
  NULL

#very large
nrow(all_results %>% filter(biomass > 100000))

all_results %>% filter(biomass > 100000) %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = n_keep, x = exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from GAM"
  ) +
 # facet_wrap(~state) +
  xlim(0,3e+07) +
  ylim(0,3e+07) +
  NULL

#need to run "all_results <- purrr::pmap_dfr(params,read_results, om.name=5)" line again after running the preceding code in this chunk
all_results %>% 
  mutate(ratio = 1000*keep_num / (exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3")      )) %>% 
  ggplot() + 
  aes(x = #0.39*
        exp_keep, y = 
        1000*keep_num,# size = biomass,
      col = biomass) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
 # geom_smooth(method = "glm", formula = y ~ x, method.args = list(family = #"poisson"), col ="blue") +
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  xlim(0,5e7) +
  ylim(0,5e7) +
  facet_wrap(~mp3) +
  labs(    y = "harvest number from RDM",
           x = "expected harvest from GAM") +
  NULL
```

Newer Runs Projection 
```{r}
#slightly modified projection plot from top of script <- both are pretty much interchangeable 
projection.plot <- function(project.results) {
  project.results <- project.results %>% 
    #filter(type %in% c("biomass","catch")) %>%
    I()
  project.results %>% 
    #group_by(scenario, type, year) %>% 
    #median_qi(value, .width = c(.5, .8, .95)) %>%
    ggplot() +  
    stat_lineribbon(aes(x = year, y = value, fill = mp2),
                    #show.legend = FALSE,
                    alpha = 0.35) +
    # geom_lineribbon(aes(x = year, y = value, ymin = .lower, ymax = .upper, fill = scenario),
    #                 show.legend = FALSE) +
    scale_fill_brewer(type = "qual", palette = 2) +
    facet_wrap(~mp2, scale = "free") + 
    geom_line(aes(y=value,x=year,group=mp2),data = subset(project.results, type != "index" & isim==1), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    geom_line(aes(y=value,x=year,group=mp2),data = subset(project.results, type != "index" & isim==2), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    geom_line(aes(y=value,x=year,group=mp2),data = subset(project.results, type != "index" & isim==3), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    geom_line(aes(y=value,x=year,group=mp2),data = subset(project.results, type != "index" & isim==4), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    ylim(0,1e7) + #originally 3000
    ylab("") + 
    xlab("Year") +
    theme_bw() +
    theme(legend.position= "none") + #,
    #axis.text.y = element_blank()) +
    labs(fill = "",
         subtitle = "Expected Harvest from RDM Emulator")
}

#minlen
diag_ts %>% 
  mutate(value = ifelse(type == "exp_keep",  1*value, value),
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA", #c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                    "Percent Change Approach" = "PCA", #c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                    "Biological Ref. Point" = "BRP", #c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                    "Biomass Matrix" = "BBM"), #c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag", #c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "Minlen" = "Length", #c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "Season" = "Season", #c("STable3","STable3.1","STable3.2","STable3.3"),
                            "All" = "All"#c("ATable3","ATable3.1","ATable3.2","ATable3.3")  
                            )) %>% 
  filter(year != 2019) %>% 
#  mutate(type = fct_relevel(type,c("spawning biomass", "total catch"))) %>% 
 filter(type == "exp_keep", mp3 == "Minlen") %>% 
  projection.plot() 

#bag
diag_ts %>% 
  mutate(value = ifelse(type == "exp_keep",  1*value, value),
        mp2 = fct_collapse(scenario,
                     "No Change (RHL as target)" = "NCA", #c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                    "Percent Change Approach" = "PCA", #c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                    "Biological Ref. Point" = "BRP", #c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                    "Biomass Matrix" = "BBM"), #c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag", #c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "Minlen" = "Length", #c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "Season" = "Season", #c("STable3","STable3.1","STable3.2","STable3.3"),
                            "All" = "All"#c("ATable3","ATable3.1","ATable3.2","ATable3.3")  
                            )) %>% 
  filter(year != 2019) %>% 
#  mutate(type = fct_relevel(type,c("spawning biomass", "total catch"))) %>% 
 filter(type == "exp_keep", mp3 == "Bag") %>% 
  projection.plot() 

#seaslen
diag_ts %>% 
  mutate(value = ifelse(type == "exp_keep",  1*value, value),
        mp2 = fct_collapse(scenario,
                       "No Change (RHL as target)" = "NCA", #c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                    "Percent Change Approach" = "PCA", #c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                    "Biological Ref. Point" = "BRP", #c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                    "Biomass Matrix" = "BBM"), #c("BTable3","LTable3","STable3", "ATable3")),
           mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag", #c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "Minlen" = "Length", #c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "Season" = "Season", #c("STable3","STable3.1","STable3.2","STable3.3"),
                            "All" = "All"#c("ATable3","ATable3.1","ATable3.2","ATable3.3")  
                            )) %>% 
  filter(year != 2019) %>% 
#  mutate(type = fct_relevel(type,c("spawning biomass", "total catch"))) %>% 
 filter(type == "exp_keep", mp3 == "Season") %>% 
  projection.plot() 

#all
diag_ts %>% 
  mutate(value = ifelse(type == "exp_keep",  1*value, value),
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA", #c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                    "Percent Change Approach" = "PCA", #c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                    "Biological Ref. Point" = "BRP", #c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                    "Biomass Matrix" = "BBM"), #c("BTable3","LTable3","STable3", "ATable3")),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag", #c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "Minlen" = "Length", #c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "Season" = "Season", #c("STable3","STable3.1","STable3.2","STable3.3"),
                            "All" = "All"#c("ATable3","ATable3.1","ATable3.2","ATable3.3")  
                            )) %>% 
  filter(year != 2019) %>% 
#  mutate(type = fct_relevel(type,c("spawning biomass", "total catch"))) %>% 
 filter(type == "exp_keep", mp3 == "All") %>% 
  projection.plot() 
```

Time Series of Regulation Changes Over Time - not in MS
```{r}
#run projection plot function first 

##### regulation changes over time 

#all regulations scenario 

#bag
diag_ts  %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "bag", mp3 == "All") %>% 
  projection.plot()   + 
  ylim(0,10) + 
  scale_y_continuous(breaks = 3:9) + 
  ylab("Bag Limit") + 
  labs(subtitle  = "Effect of HCR on Bag Limit: Any Regulations Can Change")

#minlen
diag_ts %>%  
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "minlen", mp3 == "All") %>% 
  projection.plot()  + 
  ylim(13,22) + 
  scale_y_continuous(breaks = 13:22) +
  ylab("Minimum Size Limit") + 
  labs(subtitle  = "Effect of HCR on Minimum Size Limit: Any Regulations Can Change")

#seaslen
diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "seaslen", mp3 == "All") %>% 
  projection.plot()  + 
  ylim(50,310) + 
  scale_y_continuous(breaks = seq(60, 300, by = 30)) +
  ylab("Season Length") + 
  labs(subtitle  = "Effect of HCR on Season Length: Any Regulations Can Change")

#individual reg change scenario 

#bag
diag_ts  %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "bag", mp3 == "Bag") %>% 
  projection.plot()   + 
  ylim(0,10) + 
  scale_y_continuous(breaks = 3:9) + 
  ylab("Bag Limit") + 
  labs(subtitle  = "Effect of HCR on Bag Limit: Bag Limit Change Only")

#minlen
diag_ts %>%  
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "minlen", mp3 == "Minlen") %>% 
  projection.plot()  + 
  ylim(13,22) + 
  scale_y_continuous(breaks = 13:22) +
  ylab("Minimum Size Limit") + 
  labs(subtitle  = "Effect of HCR on Minimum Size Limit: Minimum Size Limit Change Only")

#seaslen
diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "seaslen", mp3 == "Season") %>% 
  projection.plot()  + 
  ylim(50,310) + 
  scale_y_continuous(breaks = seq(60, 300, by = 30)) +
  ylab("Season Length") + 
  labs(subtitle  = "Effect of HCR on Season Length: Season Length Change Only")

#BOXPLOTS OF MEAN REGULATIONS 

#all regulations scenario 

#bag
diag_ts  %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "bag", mp3 == "All") %>% 
  ggplot(aes(x = mp2, y = value, fill = mp2)) + # adjust y variable if needed
  geom_boxplot() +
    scale_fill_manual(values = c("No Change (RHL as target)" = "#7570b3", 
                                "Percent Change Approach" = "#e7298a", 
                                "Biomass Matrix" = "#1b9e77", 
                                "Biological Ref. Point" = "#d95f02")) +
  xlab("Harvest Control Rule") + 
  ylim(0,10) + 
  scale_y_continuous(breaks = 3:9) + 
  ylab("Bag Limit") + 
  ggtitle("Effect of HCR on Bag Limit: Any Regulations Can Change") + 
  theme(legend.position = "none")

#minlen
diag_ts %>%  
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "minlen", mp3 == "All") %>% 
  ggplot(aes(x = mp2, y = value, fill = mp2)) + # adjust y variable if needed
  geom_boxplot() +
    scale_fill_manual(values = c("No Change (RHL as target)" = "#7570b3", 
                                "Percent Change Approach" = "#e7298a", 
                                "Biomass Matrix" = "#1b9e77", 
                                "Biological Ref. Point" = "#d95f02")) +
  xlab("Harvest Control Rule") + 
  ylim(13,22) + 
  scale_y_continuous(breaks = 13:22) +
  ylab("Minimum Size Limit") + 
  ggtitle("Effect of HCR on Minimum Size Limit: Any Regulations Can Change") + 
  theme(legend.position = "none")

#seaslen
diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "seaslen", mp3 == "All") %>% 
  ggplot(aes(x = mp2, y = value, fill = mp2)) + # adjust y variable if needed
  geom_boxplot() +
    scale_fill_manual(values = c("No Change (RHL as target)" = "#7570b3", 
                                "Percent Change Approach" = "#e7298a", 
                                "Biomass Matrix" = "#1b9e77", 
                                "Biological Ref. Point" = "#d95f02")) +
  xlab("Harvest Control Rule") + 
  ylim(50,310) + 
  scale_y_continuous(breaks = seq(60, 300, by = 30)) +
  ylab("Season Length") + 
  ggtitle("Effect of HCR on Season Length: Any Regulations Can Change") + 
  theme(legend.position = "none")

#individual reg change scenario 

#bag
diag_ts  %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "bag", mp3 == "Bag") %>% 
  ggplot(aes(x = mp2, y = value, fill = mp2)) + # adjust y variable if needed
  geom_boxplot() +
    scale_fill_manual(values = c("No Change (RHL as target)" = "#7570b3", 
                                "Percent Change Approach" = "#e7298a", 
                                "Biomass Matrix" = "#1b9e77", 
                                "Biological Ref. Point" = "#d95f02")) +
  xlab("Harvest Control Rule") + 
  ylim(0,10) + 
  scale_y_continuous(breaks = 3:9) + 
  ylab("Bag Limit") + 
  ggtitle("Effect of HCR on Bag Limit: Bag Limit Change Only") + 
  theme(legend.position = "none")

#minlen
diag_ts %>%  
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "minlen", mp3 == "Minlen") %>% 
  ggplot(aes(x = mp2, y = value, fill = mp2)) + # adjust y variable if needed
  geom_boxplot() +
    scale_fill_manual(values = c("No Change (RHL as target)" = "#7570b3", 
                                "Percent Change Approach" = "#e7298a", 
                                "Biomass Matrix" = "#1b9e77", 
                                "Biological Ref. Point" = "#d95f02")) +
  xlab("Harvest Control Rule") + 
  ylim(13,22) + 
  scale_y_continuous(breaks = 13:22) +
  ylab("Minimum Size Limit") + 
  ggtitle("Effect of HCR on Minimum Size Limit: Minimum Size Limit Change Only") + 
  theme(legend.position = "none")

#seaslen
diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
 filter(type == "seaslen", mp3 == "Season") %>% 
  ggplot(aes(x = mp2, y = value, fill = mp2)) + # adjust y variable if needed
  geom_boxplot() +
  scale_fill_manual(values = c("No Change (RHL as target)" = "#7570b3", 
                                "Percent Change Approach" = "#e7298a", 
                                "Biomass Matrix" = "#1b9e77", 
                                "Biological Ref. Point" = "#d95f02")) +
  xlab("Harvest Control Rule") + 
  ylim(50, 310) +
  scale_y_continuous(breaks = seq(60, 300, by = 30)) +
  ylab("Season Length") +
  ggtitle("Effect of HCR on Season Length: Season Length Change Only") + 
  theme(legend.position = "none")

##### regulation changes as related to performance 

#calculate upper and lower 50 percentiles of performance metrics, then plot regulation changes for each HCR with some threshold added for "good" vs "bad" performance 

#for starters just do the six performance metrics in the radars 

#extract 50th percentile line for intercepts 

keepone <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "keep_one")
keepone_percentiles <- data.frame(upper50 = keepone$upper50, lower50 = keepone$lower50)

keptreleased <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "kept:released")
keptreleased_percentiles <- data.frame(upper50 = keptreleased$upper50, lower50 = keptreleased$lower50) 

keptpertrip <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "kept per trip")
keptpertrip_percentiles <- data.frame(upper50 = keptpertrip$upper50, lower50 = keptpertrip$lower50) 

trophy <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "trophy")
trophy_percentiles <- data.frame(upper50 = trophy$upper50, lower50 = trophy$lower50) 

notoverfishing <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "F/Fref")
#for overfishing and overfished instead of percentiles it should just be f>fmsy and b<0.5bmsy 
notoverfishing_percentiles <- data.frame(upper50 = notoverfishing$upper50, lower50 =  notoverfishing$lower50) 

notoverfished <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "B/Bref")
notoverfished_percentiles <- data.frame(upper50 = notoverfished$upper50, lower50 = notoverfished$lower50)

#plot functions

diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "keep_one", RegType == "All") %>% 
  projection.plot + 
  ylim(0,1) + 
  geom_hline(yintercept = keepone_percentiles$upper50[1]) + 
  geom_hline(yintercept = keepone_percentiles$lower50[1]) +
  scale_y_continuous(seq(from = 0, to = 1, by = 0.1)) 

diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "kept:released", RegType == "All") %>% 
  projection.plot + 
  ylim(0,1) + 
  geom_hline(yintercept = keptreleased_percentiles$upper50[1]) + 
  geom_hline(yintercept = keptreleased_percentiles$lower50[1]) +
  scale_y_continuous(seq(from = 0, to = 1, by = 0.1))  

diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "kept per trip", RegType == "All") %>% 
  projection.plot + 
  ylim(0,1) + 
 geom_hline(yintercept = keptpertrip_percentiles$upper50[1]) + 
  geom_hline(yintercept = keptpertrip_percentiles$lower50[1]) +
  scale_y_continuous(seq(from = 0, to = 1, by = 0.1))  

diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "trophy", RegType == "All") %>% 
  projection.plot + 
  ylim(0,1) + 
  geom_hline(yintercept = trophy_percentiles$upper50[1]) + 
  geom_hline(yintercept = trophy_percentiles$lower50[1]) +
 scale_y_continuous(seq(from = 0, to = 1, by = 0.1))  

diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "F/Fref", RegType == "All") %>% 
  projection.plot + 
  ylim(0,1) + 
  #geom_hline(yintercept = notoverfishing_percentiles$upper50[1]) + 
  #geom_hline(yintercept = notoverfishing_percentiles$lower50[1]) +
  #different reference point for F/Fref 
  geom_hline(yintercept = 1) + 
  scale_y_continuous(seq(from = 0, to = 1, by = 0.1))  

diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  group_by(type) %>%
  mutate(lower50 = quantile(value, 0.25, na.rm = TRUE),
         upper50 = quantile(value, 0.75, na.rm = TRUE)) %>%
  ungroup() %>%
  filter(type == "B/Bref", RegType == "All") %>% 
  projection.plot + 
  ylim(0,1) + 
  #geom_hline(yintercept = notoverfished_percentiles$upper50[1]) + 
  #geom_hline(yintercept = notoverfished_percentiles$lower50[1]) +
  #different reference point for B/Fref 
  geom_hline(yintercept = 0.5) + 
  scale_y_continuous(seq(from = 0, to = 1, by = 0.1)) 
  
#maybe instead of bag limit values do it by performance metric value filtered by reg type
```

Map HCR performance more explicitly to selected regulations  
```{r}
# look at good vs. bad performance of HCRs (e.g. above or below median, upper and lower percentiles) with all simulations aggregated
# organize simulations baseed on performance above vs. below the threshold
# see how regulation values that are selected align with good or bad performance 

######### first try in the "any regs can change" code ######### 

regulationvalues <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("bag", "minlen", "seaslen")) %>% 
  filter(RegType == "All") %>% 
  select(isim, year, type, value, RegType, mp2)

bagvalues <- regulationvalues %>% 
  filter(type == "bag") %>% 
  rename(bag_type = type, bag_value = value)

seasvalues <- regulationvalues %>%
  filter(type == "seaslen") %>% 
  rename(seas_type = type, seas_value = value)

minlenvalues <- regulationvalues %>% 
  filter(type == "minlen") %>% 
  rename(minlen_type = type, minlen_value = value)

metricperformance_all <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("rel per trip", "spawning biomass", "ntrips", 
                     "trophy", "F/Fref", "B/Bref", "kept per trip",
                     "keep_one", "prop_female", "kept:released",
                     "cs_per_trip", "rec_removals")) %>%
  group_by(type) %>%
  mutate(median = case_when(
    type == "F/Fref" ~ 1,
    type == "B/Bref" ~ 0.5,
    TRUE ~ median(value, na.rm = TRUE))) %>%
  ungroup() %>%
  mutate(performance = case_when(
    type == "F/Fref" & value > median ~ "bad",
    type == "F/Fref" & value <= median ~ "good",
    value > median  ~ "good",
    value <= median ~ "bad",
    TRUE ~ NA_character_ 
  )) %>% 
  select(isim, year, type, value, RegType, mp2, median, performance) %>%
  filter(RegType == "All")

relpertrip <- metricperformance_all %>% filter(type == "rel per trip") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))
              
spawbio <- metricperformance_all %>% filter(type == "spawning biomass") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

ntrips <- metricperformance_all %>% filter(type == "ntrips") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

trophy <- metricperformance_all %>% filter(type == "trophy") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2")) 

notoverfishing <- metricperformance_all %>% filter(type == "F/Fref") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  filter(!is.na(performance))

notoverfished <- metricperformance_all %>% filter(type == "B/Bref") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2")) 

keptpertrip <- metricperformance_all %>% filter(type == "kept per trip") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

keepone <- metricperformance_all %>% filter(type == "keep_one") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

propfemale <- metricperformance_all %>% filter(type == "prop_female") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

keptreleased <- metricperformance_all %>% filter(type == "kept:released") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

cspertrip <- metricperformance_all %>% filter(type == "cs_per_trip") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

recremovals <- metricperformance_all %>% filter(type == "rec_removals") %>%
  left_join(bagvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(seasvalues, by = c("isim", "year", "RegType", "mp2")) %>%
  left_join(minlenvalues, by = c("isim", "year", "RegType", "mp2"))

#visualize this as series of faceted boxplots 

performancemetrics <- bind_rows(relpertrip, spawbio, ntrips, trophy, notoverfishing, notoverfished, 
                                keptpertrip, keepone, propfemale, keptreleased, cspertrip, recremovals)

#bag limit 
#ggplot(performancemetrics, aes(x = performance, y = bag_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Bag Limit on HCR Performance: All HCRs",
    #x = "Performance Status",
    #y = "Bag Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#min size limit 
#ggplot(performancemetrics, aes(x = performance, y = minlen_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Min Size on HCR Performance: All HCRs",
    #x = "Performance Status",
    #y = "Minimum Size Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#season length limit 
#ggplot(performancemetrics, aes(x = performance, y = seas_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Season Length on HCR Performance: All HCRs",
    #x = "Performance Status",
    #y = "Season Length"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#now do it by HCR

#performancemetrics_BBM <- performancemetrics %>% filter(mp2 == "Biomass Matrix")
#performancemetrics_BRP <- performancemetrics %>% filter(mp2 == "Biological Ref. Point")
#performancemetrics_NCA <- performancemetrics %>% filter(mp2 == "No Change (RHL as target)")
#performancemetrics_PCA <- performancemetrics %>% filter(mp2 == "Percent Change Approach")

#BBM 

#bag limit 
#ggplot(performancemetrics_BBM, aes(x = performance, y = bag_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Bag Limit on HCR Performance: Biomass Matrix",
    #x = "Performance Status",
    #y = "Bag Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#min size limit 
#ggplot(performancemetrics_BBM, aes(x = performance, y = minlen_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Min Size on HCR Performance: Biomass Matrix",
    #x = "Performance Status",
    #y = "Minimum Size Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#season length limit 
#ggplot(performancemetrics_BBM, aes(x = performance, y = seas_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Season Length on HCR Performance: Biomass Matrix",
    #x = "Performance Status",
    #y = "Season Length"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#BRP

#bag limit 
#ggplot(performancemetrics_BRP, aes(x = performance, y = bag_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Bag Limit on HCR Performance: Biological Ref. Point",
    #x = "Performance Status",
    #y = "Bag Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#min size limit 
#ggplot(performancemetrics_BRP, aes(x = performance, y = minlen_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Min Size on HCR Performance: Biological Ref. Point",
    #x = "Performance Status",
    #y = "Minimum Size Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#season length limit 
#ggplot(performancemetrics_BRP, aes(x = performance, y = seas_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Season Length on HCR Performance: Biological Ref. Point",
    #x = "Performance Status",
    #y = "Season Length"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#NCA

#bag limit 
#ggplot(performancemetrics_NCA, aes(x = performance, y = bag_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Bag Limit on HCR Performance: RHL-based",
    #x = "Performance Status",
    #y = "Bag Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#min size limit 
#ggplot(performancemetrics_NCA, aes(x = performance, y = minlen_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Min Size on HCR Performance: RHL-based",
    #x = "Performance Status",
    #y = "Minimum Size Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#season length limit 
#ggplot(performancemetrics_NCA, aes(x = performance, y = seas_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Season Length on HCR Performance: RHL-based",
    #x = "Performance Status",
    #y = "Season Length"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#PCA

#bag limit 
#ggplot(performancemetrics_PCA, aes(x = performance, y = bag_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Bag Limit on HCR Performance: Percent Change Approach",
    #x = "Performance Status",
    #y = "Bag Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#min size limit 
#ggplot(performancemetrics_PCA, aes(x = performance, y = minlen_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Min Size on HCR Performance: Percent Change Approach",
    #x = "Performance Status",
    #y = "Minimum Size Limit"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#season length limit 
#ggplot(performancemetrics_PCA, aes(x = performance, y = seas_value, fill = performance)) +
  #geom_boxplot(outlier.alpha = 0.5) +
  #facet_wrap(~type, ncol = 4) + 
  #theme_minimal() +
  #labs(
    #title = "Effect of Season Length on HCR Performance: Percent Change Approach",
    #x = "Performance Status",
    #y = "Season Length"
  #) +
  #scale_fill_manual(values = c("good" = "#56B4E9", "bad" = "#E69F00"))

#the above approach makes it clear that some regulation changes have more pronounced effects than others
#it also shows that these effects vary by HCR, but it would be good to have plots that compare the different HCRs more directly
#I still like some of the observations from the time series; e.g. the extent to which results remain consistent over time or change 

#same boxplots as above but have all the HCRs on either side 

#bag limit 
ggplot(performancemetrics, aes(x = performance, y = bag_value, fill = factor(mp2))) +
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "black", size = 0.8) +
  geom_boxplot(outlier.alpha = 0.5) +
  facet_wrap(~type, ncol = 4) + 
  theme_minimal() +
  labs(
    title = "Effect of Bag Limit on HCR Performance: Any Regulations can Change",
    x = "Harvest Control Rule Relative Performance",
    y = "Bag Limit",
    fill = "Harvest Control Rule"
  ) +
  scale_x_discrete(
    labels = c("good" = "Good", "bad" = "Bad")
  ) + 
  scale_fill_manual(values = c("Biomass Matrix" = "#1b9e77", "Biological Ref. Point" = "#d95f02",
                               "No Change (RHL as target)" = "#7570b3", "Percent Change Approach" = "#e7298a"))

#min size limit 
ggplot(performancemetrics, aes(x = performance, y = minlen_value, fill = factor(mp2))) +
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "black", size = 0.8) +
  geom_boxplot(outlier.alpha = 0.5) +
  facet_wrap(~type, ncol = 4) + 
  theme_minimal() +
  labs(
    title = "Effect of Minimum Size Limit on HCR Performance: Any Regulations can Change",
    x = "Harvest Control Rule Relative Performance",
    y = "Minimum Size Limit",
    fill = "Harvest Control Rule"
  ) + 
  scale_x_discrete(
    labels = c("good" = "Good", "bad" = "Bad")
  ) + 
  scale_fill_manual(values = c("Biomass Matrix" = "#1b9e77", "Biological Ref. Point" = "#d95f02",
                               "No Change (RHL as target)" = "#7570b3", "Percent Change Approach" = "#e7298a"))

#season length limit 
ggplot(performancemetrics, aes(x = performance, y = seas_value, fill = factor(mp2))) +
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "black", size = 0.8) +
  geom_boxplot(outlier.alpha = 0.5) +
  facet_wrap(~type, ncol = 4) + 
  theme_minimal() +
  labs(
    title = "Effect of Season Length on HCR Performance: Any Regulations can Change",
    x = "Harvest Control Rule Relative Performance",
    y = "Season Length",
    fill = "Harvest Control Rule"
  ) + 
  scale_x_discrete(
    labels = c("good" = "Good", "bad" = "Bad")
  ) + 
   scale_fill_manual(values = c("Biomass Matrix" = "#1b9e77", "Biological Ref. Point" = "#d95f02",
                               "No Change (RHL as target)" = "#7570b3", "Percent Change Approach" = "#e7298a"))

######### now each reg change at a time ######### 

####### bag 
regulationvalues_bag <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("bag", "minlen", "seaslen")) %>% 
  filter(RegType == "Bag") %>% 
  select(isim, year, type, value, RegType, mp2)

bagvalues_bag <- regulationvalues_bag %>% 
  filter(type == "bag") %>% 
  rename(bag_type = type, bag_value = value)

metricperformance_bag <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("rel per trip", "spawning biomass", "ntrips", 
                     "trophy", "F/Fref", "B/Bref", "kept per trip",
                     "keep_one", "prop_female", "kept:released",
                     "cs_per_trip", "rec_removals")) %>%
  group_by(type) %>%
  mutate(median = case_when(
    type == "F/Fref" ~ 1,
    type == "B/Bref" ~ 0.5,
    TRUE ~ median(value, na.rm = TRUE))) %>%
  ungroup() %>%
  mutate(performance = case_when(
    type == "F/Fref" & value > median ~ "bad",
    type == "F/Fref" & value <= median ~ "good",
    value > median  ~ "good",
    value <= median ~ "bad",
    TRUE ~ NA_character_ 
  )) %>% 
  select(isim, year, type, value, RegType, mp2, median, performance) %>%
  filter(RegType == "Bag")

relpertrip_bag <- metricperformance_bag %>% filter(type == "rel per trip") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))
              
spawbio_bag <- metricperformance_bag %>% filter(type == "spawning biomass") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

ntrips_bag <- metricperformance_bag %>% filter(type == "ntrips") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

trophy_bag <- metricperformance_bag %>% filter(type == "trophy") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

notoverfishing_bag <- metricperformance_bag %>% filter(type == "F/Fref") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2")) %>%
  filter(!is.na(performance))

notoverfished_bag <- metricperformance_bag %>% filter(type == "B/Bref") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2")) 

keptpertrip_bag <- metricperformance_bag %>% filter(type == "kept per trip") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

keepone_bag <- metricperformance_bag %>% filter(type == "keep_one") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

propfemale_bag <- metricperformance_bag %>% filter(type == "prop_female") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

keptreleased_bag <- metricperformance_bag %>% filter(type == "kept:released") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

cspertrip_bag <- metricperformance_bag %>% filter(type == "cs_per_trip") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

recremovals_bag <- metricperformance_bag %>% filter(type == "rec_removals") %>%
  left_join(bagvalues_bag, by = c("isim", "year", "RegType", "mp2"))

#visualize this as series of faceted boxplots 

performancemetrics_bag <- bind_rows(relpertrip_bag, spawbio_bag, ntrips_bag, trophy_bag, notoverfishing_bag, notoverfished_bag, 
                                keptpertrip_bag, keepone_bag, propfemale_bag, keptreleased_bag, cspertrip_bag, recremovals_bag)

#bag limit boxplot
ggplot(performancemetrics_bag, aes(x = performance, y = bag_value, fill = factor(mp2))) +
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "black", size = 0.8) +
  geom_boxplot(outlier.alpha = 0.5) +
  facet_wrap(~type, ncol = 4) + 
  theme_minimal() +
  labs(
    title = "Effect of Bag Limit on HCR Performance: Bag Limit Only",
    x = "Harvest Control Rule Relative Performance",
    y = "Bag Limit",
    fill = "Harvest Control Rule"
  ) +
  scale_x_discrete(
    labels = c("good" = "Good", "bad" = "Bad")
  ) + 
  scale_fill_manual(values = c("Biomass Matrix" = "#1b9e77", "Biological Ref. Point" = "#d95f02",
                               "No Change (RHL as target)" = "#7570b3", "Percent Change Approach" = "#e7298a"))

####### minlen
regulationvalues_minlen <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("bag", "minlen", "seaslen")) %>% 
  filter(RegType == "Length") %>% 
  select(isim, year, type, value, RegType, mp2)

minlenvalues_minlen <- regulationvalues_minlen %>% 
  filter(type == "minlen") %>% 
  rename(minlen_type = type, minlen_value = value)

metricperformance_minlen <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("rel per trip", "spawning biomass", "ntrips", 
                     "trophy", "F/Fref", "B/Bref", "kept per trip",
                     "keep_one", "prop_female", "kept:released",
                     "cs_per_trip", "rec_removals")) %>%
  group_by(type) %>%
  mutate(median = case_when(
    type == "F/Fref" ~ 1,
    type == "B/Bref" ~ 0.5,
    TRUE ~ median(value, na.rm = TRUE))) %>%
  ungroup() %>%
  mutate(performance = case_when(
    type == "F/Fref" & value > median ~ "bad",
    type == "F/Fref" & value <= median ~ "good",
    value > median  ~ "good",
    value <= median ~ "bad",
    TRUE ~ NA_character_ 
  )) %>% 
  select(isim, year, type, value, RegType, mp2, median, performance) %>%
  filter(RegType == "Length")

relpertrip_minlen <- metricperformance_minlen %>% filter(type == "rel per trip") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))
              
spawbio_minlen <- metricperformance_minlen %>% filter(type == "spawning biomass") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

ntrips_minlen <- metricperformance_minlen %>% filter(type == "ntrips") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

trophy_minlen <- metricperformance_minlen %>% filter(type == "trophy") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

notoverfishing_minlen <- metricperformance_minlen %>% filter(type == "F/Fref") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2")) %>%
  filter(!is.na(performance))

notoverfished_minlen <- metricperformance_minlen %>% filter(type == "B/Bref") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2")) 

keptpertrip_minlen <- metricperformance_minlen %>% filter(type == "kept per trip") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

keepone_minlen <- metricperformance_minlen %>% filter(type == "keep_one") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

propfemale_minlen <- metricperformance_minlen %>% filter(type == "prop_female") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

keptreleased_minlen <- metricperformance_minlen %>% filter(type == "kept:released") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

cspertrip_minlen <- metricperformance_minlen %>% filter(type == "cs_per_trip") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

recremovals_minlen <- metricperformance_minlen %>% filter(type == "rec_removals") %>%
  left_join(minlenvalues_minlen, by = c("isim", "year", "RegType", "mp2"))

#visualize this as series of faceted boxplots 

performancemetrics_minlen <- bind_rows(relpertrip_minlen, spawbio_minlen, ntrips_minlen, trophy_minlen, notoverfishing_minlen, notoverfished_minlen, keptpertrip_minlen, keepone_minlen, propfemale_minlen, keptreleased_minlen, cspertrip_minlen, recremovals_minlen)

#minimum size limit boxplot
ggplot(performancemetrics_minlen, aes(x = performance, y = minlen_value, fill = factor(mp2))) +
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "black", size = 0.8) +
  geom_boxplot(outlier.alpha = 0.5) +
  facet_wrap(~type, ncol = 4) + 
  theme_minimal() +
  labs(
    title = "Effect of Minimum Size Limit on HCR Performance: Minimum Size Limit Only",
    x = "Harvest Control Rule Relative Performance",
    y = "Minimum Size Limit",
    fill = "Harvest Control Rule"
  ) +
  scale_x_discrete(
    labels = c("good" = "Good", "bad" = "Bad")
  ) + 
  scale_fill_manual(values = c("Biomass Matrix" = "#1b9e77", "Biological Ref. Point" = "#d95f02",
                               "No Change (RHL as target)" = "#7570b3", "Percent Change Approach" = "#e7298a"))

####### seaslen
regulationvalues_seaslen <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("bag", "minlen", "seaslen")) %>% 
  filter(RegType == "Season") %>% 
  select(isim, year, type, value, RegType, mp2)

seaslenvalues_seaslen <- regulationvalues_seaslen %>% 
  filter(type == "seaslen") %>% 
  rename(seaslen_type = type, seaslen_value = value)

metricperformance_seaslen <- diag_ts %>% 
  mutate(
        mp2 = fct_collapse(scenario,
                    "No Change (RHL as target)" = "NCA",
                    "Percent Change Approach" = "PCA",
                    "Biological Ref. Point" = "BRP",
                    "Biomass Matrix" = "BBM"),
          mp3 = fct_collapse(RegType, #scenario, 
                            "Bag" = "Bag",
                            "Minlen" = "Length",
                            "Season" = "Season", 
                            "All" = "All"
                            )) %>% 
  filter(year != 2019) %>% 
  filter(type %in% c("rel per trip", "spawning biomass", "ntrips", 
                     "trophy", "F/Fref", "B/Bref", "kept per trip",
                     "keep_one", "prop_female", "kept:released",
                     "cs_per_trip", "rec_removals")) %>%
  group_by(type) %>%
  mutate(median = case_when(
    type == "F/Fref" ~ 1,
    type == "B/Bref" ~ 0.5,
    TRUE ~ median(value, na.rm = TRUE))) %>%
  ungroup() %>%
  mutate(performance = case_when(
    type == "F/Fref" & value > median ~ "bad",
    type == "F/Fref" & value <= median ~ "good",
    value > median  ~ "good",
    value <= median ~ "bad",
    TRUE ~ NA_character_ 
  )) %>% 
  select(isim, year, type, value, RegType, mp2, median, performance) %>%
  filter(RegType == "Season")

relpertrip_seaslen <- metricperformance_seaslen %>% filter(type == "rel per trip") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))
              
spawbio_seaslen <- metricperformance_seaslen %>% filter(type == "spawning biomass") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

ntrips_seaslen <- metricperformance_seaslen %>% filter(type == "ntrips") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

trophy_seaslen <- metricperformance_seaslen %>% filter(type == "trophy") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

notoverfishing_seaslen <- metricperformance_seaslen %>% filter(type == "F/Fref") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2")) %>%
  filter(!is.na(performance))

notoverfished_seaslen <- metricperformance_seaslen %>% filter(type == "B/Bref") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2")) 

keptpertrip_seaslen <- metricperformance_seaslen %>% filter(type == "kept per trip") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

keepone_seaslen <- metricperformance_seaslen %>% filter(type == "keep_one") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

propfemale_seaslen <- metricperformance_seaslen %>% filter(type == "prop_female") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

keptreleased_seaslen <- metricperformance_seaslen %>% filter(type == "kept:released") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

cspertrip_seaslen <- metricperformance_seaslen %>% filter(type == "cs_per_trip") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

recremovals_seaslen <- metricperformance_seaslen %>% filter(type == "rec_removals") %>%
  left_join(seaslenvalues_seaslen, by = c("isim", "year", "RegType", "mp2"))

#visualize this as series of faceted boxplots 

performancemetrics_seaslen <- bind_rows(relpertrip_seaslen, spawbio_seaslen, ntrips_seaslen, trophy_seaslen, notoverfishing_seaslen, notoverfished_seaslen, keptpertrip_seaslen, keepone_seaslen, propfemale_seaslen, keptreleased_seaslen, cspertrip_seaslen, recremovals_seaslen)

#season length boxplot
ggplot(performancemetrics_seaslen, aes(x = performance, y = seaslen_value, fill = factor(mp2))) +
  geom_vline(xintercept = 1.5, linetype = "dashed", color = "black", size = 0.8) +
  geom_boxplot(outlier.alpha = 0.5) +
  facet_wrap(~type, ncol = 4) + 
  theme_minimal() +
  labs(
    title = "Effect of Season Length on HCR Performance: Season Length Only",
    x = "Harvest Control Rule Relative Performance",
    y = "Season Length",
    fill = "Harvest Control Rule"
  ) +
  scale_x_discrete(
    labels = c("good" = "Good", "bad" = "Bad")
  ) + 
  scale_fill_manual(values = c("Biomass Matrix" = "#1b9e77", "Biological Ref. Point" = "#d95f02",
                               "No Change (RHL as target)" = "#7570b3", "Percent Change Approach" = "#e7298a"))

```

Calculating/Visualizing performance metrics differently - not in MS
```{r}

# as change from status quo/starting 
metrics <- diag_ts %>% 
  filter(year != 2019) %>%
  group_by(om, scenario, year, isim,
         RegType, #for if using code, remove this if merging from spreadsheet 
           type) %>% 
  summarize(value = case_when(
    type == "F/Fref" ~ mean(value<1, na.rm=TRUE),
    type == "B/Bref" ~ mean(value>0.5, na.rm=TRUE),
    TRUE ~ mean(value, na.rm=TRUE)), .groups = "drop") %>% 
  distinct() %>%  #unsure what is happening, but this helps.
  rename(metric = type,
         mp = scenario) %>% 
  mutate(metric = case_when(
    metric == "F/Fref" ~ "not overfishing",
    metric == "B/Bref" ~ "not overfished",
    TRUE ~ metric)) %>%
  filter(year %in% c(2020:2045)) %>%
  pivot_wider(names_from = year, 
              values_from = value,
              names_prefix = "value_") %>%
  mutate(change_in_metric = (value_2045 - value_2020)) %>% rename(value = change_in_metric)

#percentage change between 2020-2045

metrics <- diag_ts %>% 
  filter(year != 2019) %>%
  group_by(om, scenario, year, isim,
         RegType, #for if using code, remove this if merging from spreadsheet 
           type) %>% 
  summarize(value = case_when(
    type == "F/Fref" ~ mean(value<1, na.rm=TRUE),
    type == "B/Bref" ~ mean(value>0.5, na.rm=TRUE),
    TRUE ~ mean(value, na.rm=TRUE)), .groups = "drop") %>% 
  distinct() %>%  #unsure what is happening, but this helps.
  rename(metric = type,
         mp = scenario) %>% 
  mutate(metric = case_when(
    metric == "F/Fref" ~ "not overfishing",
    metric == "B/Bref" ~ "not overfished",
    TRUE ~ metric)) %>%
  filter(year %in% c(2020:2045)) %>%
  pivot_wider(names_from = year, 
              values_from = value,
              names_prefix = "value_") %>%
  mutate(change_in_metric = ((value_2045-value_2020)/value_2020)*100)  %>% rename(value = change_in_metric)

#take average or median of the last five or ten years relative to the first year/first five year for all OM simulations and then take the median of that? 
#median of last ten years relative to value at start 

metrics <- diag_ts %>% 
  filter(year != 2019) %>%
  group_by(om, scenario, year, isim,
         RegType, #for if using code, remove this if merging from spreadsheet 
           type) %>% 
  summarize(value = case_when(
    type == "F/Fref" ~ mean(value<1, na.rm=TRUE),
    type == "B/Bref" ~ mean(value>0.5, na.rm=TRUE),
    TRUE ~ mean(value, na.rm=TRUE)), .groups = "drop") %>% 
  distinct() %>%  #unsure what is happening, but this helps.
  rename(metric = type,
         mp = scenario) %>% 
  mutate(metric = case_when(
    metric == "F/Fref" ~ "not overfishing",
    metric == "B/Bref" ~ "not overfished",
    TRUE ~ metric)) %>%
  filter(year %in% c(2020:2045)) %>%
  pivot_wider(names_from = year, 
              values_from = value,
              names_prefix = "value_") %>% 
  rowwise() %>%
  mutate(change_in_metric = median( c_across(value_2036:value_2045), 
                                     na.rm = TRUE ) - value_2020 
         ) %>% 
  ungroup() %>% 
  rename(value = change_in_metric)

#plot histogram of starting values 

#by HCRs
metrics %>%
filter(metric == "keep_one") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~mp) + 
  xlab("keep_one_2020")

metrics %>%
filter(metric == "kept per trip") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~mp) + 
  xlab("keep_per_trip_2020")

metrics %>%
filter(metric == "kept:released") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~mp) + 
  xlab("kept:released_2020")

metrics %>%
filter(metric == "ntrips") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~mp) + 
  xlab("ntrips")

#by fishing regs 
metrics %>%
filter(metric == "keep_one") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~RegType) + 
  xlab("keep_one_2020")

metrics %>%
filter(metric == "kept per trip") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~RegType) + 
  xlab("keep_per_trip_2020")

metrics %>%
filter(metric == "kept:released") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~RegType) + 
  xlab("kept:released_2020")

metrics %>%
filter(metric == "ntrips") %>% 
ggplot() +
  aes(x= value_2020) +
  geom_histogram() +
  facet_wrap(~RegType) + 
  xlab("ntrips")

#maybe try comparing them relative to median 2020 baseline across all sims and scenarios per performance metric to try and standardize the starting point a bit better

metrics <- diag_ts %>% 
  filter(year != 2019) %>%
  group_by(om, scenario, year, isim,
         RegType, #for if using code, remove this if merging from spreadsheet 
           type) %>% 
  summarize(value = case_when(
    type == "F/Fref" ~ mean(value<1, na.rm=TRUE),
    type == "B/Bref" ~ mean(value>0.5, na.rm=TRUE),
    TRUE ~ mean(value, na.rm=TRUE)), .groups = "drop") %>% 
  distinct() %>%  #unsure what is happening, but this helps.
  rename(metric = type,
         mp = scenario) %>% 
  mutate(metric = case_when(
    metric == "F/Fref" ~ "not overfishing",
    metric == "B/Bref" ~ "not overfished",
    TRUE ~ metric)) %>%
  ungroup() %>% 
  filter(year %in% c(2020:2045)) %>%
  pivot_wider(names_from = year, 
              values_from = value,
              names_prefix = "value_") %>% 
  group_by(metric) %>% 
  mutate(metric_median = median(value_2020, na.rm = TRUE)) %>%
  ungroup() %>%
  rowwise() %>%
  mutate(change_in_metric = median( c_across(value_2036:value_2045), 
                                     na.rm = TRUE ) - metric_median 
         ) %>% 
  ungroup() %>% 
  rename(value = change_in_metric)

#definitely some variation in starting value; maybe calculate median of that or something?

#prep data for boxplot <- removing "not overfished" and "not overfishing" metric because they're calculated as proportion of years

metrics2 <- metrics %>% select(om, mp, isim, RegType, metric, value) %>% 
 # left_join(scen_lookup) %>% #include this if using sheet
  mutate(om = factor(om),
      #   om = fct_recode(om, "Base" = "1","MRIP Bias" = "2","Shift" = "3"),
         mp2 = fct_recode(factor(mp), #put hcr if using sheet, mp if using code in here
                          "Percent Change Approach" = "PCA",
                          "Biological Ref. Point" = "BRP",
                          "Biomass Matrix" = "BBM",
                          "No Change (RHL as target)" = "NCA"
                        ),
         mp3 = fct_collapse(factor(RegType), #reg_to_change if sheet, RegType if not
                     "Bag" = "Bag",
                      "Len" = "Length",
                         "Seas" = "Season",
                      "All" = "All"
                     ),
        mp3 = fct_relevel(mp3, "Bag", "Len", "Seas", "All"),
         #value = ifelse(metric == "exp_keep", 0.39*value, value),
         metric = factor(metric, levels = c("keep_one",
                                            "kept per trip", #_mp1",
                                            "cs_per_trip",
                                            "trophy",
                                            #"keep_one_mp1",
                                            "keep_one_range", #_mp1",
                                            "kept:released", #_mp1",
                                            #"kept:rel_range", #_mp1",
                                           # "not overfished",
                                           # "not overfishing",
                                            "spawning biomass", #_mp1",
                                            "rel per trip", #_mp1",
                                            "rec_removals", #_mp1",
                                            "prop_female",
                                            "ntrips", #_mp1",
                                            "change_cs"#,
                                            #"exp_keep"
                                            #"gdp_mp1"
                                            ))) 

#boxplot
p2 <- metrics2 %>% 
  drop_na() %>% 
  filter(!(metric %in% c("change_cs","keep_one_range"))) %>% 
 # filter(metric %in% c("keep_one", "not overfishing", "ntrips", "trophy")) %>%
  droplevels() %>% 
  #filter(om == "Base") %>% 
  ggplot() +
  aes(x = mp3, y = value, fill = mp2) +
 # aes(x = mp2, y = value, fill = mp2) +
  geom_boxplot(outlier.shape=NA) +
  scale_fill_brewer(type = "qual", palette = 2) +
  facet_wrap(~metric, scale = "free_y",drop = F) +
  ylab("Performance Metric Value") +
  xlab("Regulation to Change") +
  theme_bw() +
  theme(legend.position = "bottom") + #,
        #axis.text.x = element_blank()) +
  labs(fill = "HCR") + #,
       #subtitle = "Base scenario") +
  guides(fill = guide_legend(nrow = 1))

p2

#alternative boxplot code to better visualize percent differences since the free_y in facet is having issues

#manually set axis range 

#normal
y_limits <- list(
  "keep_one" = c(-0.2,0.2),
  "kept per trip"  = c(-0.4, 0.4),
  "cs_per_trip"   = c(-20, 20),
  "trophy"           = c(-0.05, 0.1),
  "kept:released" = c(-0.1,0.2),
  "spawning biomass" = c(-15000,40000),
  "rel per trip" = c(-1.5,3),
  "rec_removals" = c(-5000,7500),
  "prop_female" = c(-0.06,0.03),
  "ntrips" = c(-2e6,2e6)
) 

#percent
y_limits <- list(
  "keep_one" = c(-100, 200),
  "kept per trip"  = c(-100, 250),
  "cs_per_trip"   = c(-100, 100),
  "trophy"           = c(-100, 1250),
  "kept:released" = c(-100,300),
  "spawning biomass" = c(-100,200),
  "rel per trip" = c(-100,150),
  "rec_removals" = c(-100,150),
  "prop_female" = c(-12,4),
  "ntrips" = c(-20,20)
) 

plots <- metrics2 %>% 
  filter(metric %in% c("keep_one","kept per trip", "cs_per_trip",
  "trophy","kept:released","spawning biomass","rel per trip",
  "rec_removals","prop_female","ntrips")) %>%
  drop_na() %>%
  droplevels() %>%
  split(.$metric) %>%
  lapply(function(df_metric) {
    
    metric_name <- unique(df_metric$metric)
    limits <- y_limits[[metric_name]]
    
    ggplot(df_metric, aes(x = mp3, y = value, fill = mp2)) +
      geom_boxplot(outlier.shape = NA) +
      scale_fill_brewer(type = "qual", palette = 2) +
      scale_y_continuous(limits = limits) +
      ggtitle(metric_name) +
      ylab("Performance Metric Value") +
      xlab("Regulation to Change") +
      theme_bw() +
      theme(legend.position = "bottom") +
      labs(fill = "HCR") +
      guides(fill = guide_legend(nrow = 1))
  })

library(patchwork)
p2 <- wrap_plots(plots)
p2 #might need to open in separate window to see properly 
```

Line Plots for Starting B/BMSY Scenarios 
```{r}

#HCR

median_metrics22 <- readRDS("~/Desktop/FlounderMSE/median_metrics_rdsfiles/version2_seed/startbbmsydata_hcr.rds")

median_metrics_1 <- median_metrics22 %>% filter(StartBBMSY == 1)

median_metrics_2 <- median_metrics22 %>% filter(StartBBMSY == 2)

median_metrics_03 <- median_metrics22 %>% filter(StartBBMSY == 0.3)

print(unique(median_metrics22$metric))

subset_metrics <- c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals")

#first do it just as actual values instead of how they scale in relation to 1
median_metrics_subset <- median_metrics22 %>% 
  filter(if_any(everything(), ~ .x %in% subset_metrics)) #%>%
  #filter(metric %in% c("kept per trip", "kept:released", "ntrips", "prop_female"))

#if plotting HCR
levels(as.factor(median_metrics_subset$StartBBMSY))
levels(as.factor(median_metrics_subset$mp))

median_metrics_subset$metric <- factor(median_metrics_subset$metric, levels = c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals"))

ggplot(median_metrics_subset, aes(mp, value, col = as.factor(StartBBMSY), 
                                  shape = as.factor(mp), group = StartBBMSY)) + 
  geom_line() + 
  geom_point() + 
  facet_wrap(~metric, ncol = 3, scales = "free") +
  labs(x = "Harvest Control Rule", y = "Performance Metric Value", color = "Starting B/BMSY Scenario", shape = "Harvest Control Rule") +
  scale_color_manual(values = c( "0.3" = "#F8766D", "1" = "#00BA38", "2" = "#619CFF"),
                     labels = c("Start B/BMSY ~ 0.3", "Start B/BMSY ~ 1", "Start B/BMSY ~ 2")) +
  scale_shape_manual(values = c("BBM" = 16, "BRP" = 17, "NCA" = 15, "PCA" = 3),
                     labels = c("Biomass Matrix (BBM)", "Biological Ref. Point (BRP)", "No Change Approach (NCA)", "Percent Change Approach (PCA)"))

###### LINE PLOT W/CI ###### not doing it like this since it makes the plot muddy; would need to edit code above to include CIs again 

#median_metrics22 <- readRDS("~/Desktop/FlounderMSE/median_metrics_rdsfiles/MSE_median_metrics_HCR_CI.rds") #at this point the original MSE_median_metrics_HCR.rds has CIs in it

median_metrics22 <- median_metrics22 %>% rename(value = median_value)

median_metrics_1 <- median_metrics22 %>% filter(StartBBMSY == 1)

median_metrics_2 <- median_metrics22 %>% filter(StartBBMSY == 2)

median_metrics_03 <- median_metrics22 %>% filter(StartBBMSY == 0.3)

print(unique(median_metrics22$metric))

subset_metrics <- c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals")

#first do it just as actual values instead of how they scale in relation to 1
median_metrics_subset <- median_metrics22 %>% 
  filter(if_any(everything(), ~ .x %in% subset_metrics))

median_metrics_subset$metric <- factor(median_metrics_subset$metric, levels = c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals"))

#if plotting HCR

#error bar  

#stagger
pd <- position_dodge(width = 0.5)

ggplot(median_metrics_subset, aes(mp, value, col = as.factor(StartBBMSY), 
                                  shape = as.factor(mp), group = StartBBMSY)) + 
  geom_line(position = pd) + 
  geom_point(position = pd) + 
  geom_errorbar(aes(ymin = lower_ci, ymax = upper_ci), width = 0.2, position = pd) +
  facet_wrap(~metric, ncol = 3, scales = "free") +
  labs(x = "Harvest Control Rule", y = "Performance Metric Value", color = "Starting B/BMSY Scenario", shape = "Harvest Control Rule") +
  scale_color_manual(values = c( "0.3" = "#F8766D", "1" = "#00BA38", "2" = "#619CFF"),
                     labels = c("Start B/BMSY ~ 0.3", "Start B/BMSY ~ 1", "Start B/BMSY ~ 2")) +
  scale_shape_manual(values = c("BBM" = 16, "BRP" = 17, "NCA" = 15, "PCA" = 4),
                     labels = c("Biomass Matrix (BBM)", "Biological Ref. Point (BRP)", "No Change Approach (NCA)", "Percent Change Approach (PCA)"))

#ribbon?
ggplot(median_metrics_subset, aes(mp, value, group = StartBBMSY)) + 
  geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(StartBBMSY)), alpha = 0.2, color = NA) +
  geom_line(aes(color = as.factor(StartBBMSY))) + 
  geom_point(aes(shape = as.factor(mp), color = as.factor(StartBBMSY)), size = 2) +
  facet_wrap(~metric, ncol = 3, scales = "free") +
  labs(x = "Harvest Control Rule", y = "Performance Metric Value", color = "Starting B/BMSY Scenario", shape = "Harvest Control Rule") +
  scale_color_manual(values = c( "0.3" = "#F8766D", "1" = "#00BA38", "2" = "#619CFF"),
                     labels = c("Start B/BMSY ~ 0.3", "Start B/BMSY ~ 1", "Start B/BMSY ~ 2")) +
  scale_shape_manual(values = c("BBM" = 16, "BRP" = 17, "NCA" = 15, "PCA" = 3),
                     labels = c("Biomass Matrix (BBM)", "Biological Ref. Point (BRP)", "No Change Approach (NCA)", "Percent Change Approach (PCA)")) + 
  guides(fill = "none")

#Reg

median_metrics22 <- readRDS("~/Desktop/FlounderMSE/median_metrics_rdsfiles/version2_seed/startbbmsydata_reg.rds")

median_metrics_1 <- median_metrics22 %>% filter(StartBBMSY == 1)

median_metrics_2 <- median_metrics22 %>% filter(StartBBMSY == 2)

median_metrics_03 <- median_metrics22 %>% filter(StartBBMSY == 0.3)

print(unique(median_metrics22$metric))

subset_metrics <- c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals")

#first do it just as absolute values instead of how they scale in relation to 1
median_metrics_subset <- median_metrics22 %>% 
  filter(if_any(everything(), ~ .x %in% subset_metrics)) #%>%
  #filter(metric %in% c("kept per trip", "kept:released", "ntrips", "prop_female"))

#if plotting reg 
levels(as.factor(median_metrics_subset$StartBBMSY))
levels(as.factor(median_metrics_subset$RegType))

median_metrics_subset$RegType <- factor(median_metrics_subset$RegType, levels = c("Bag", "Length", "Season", "All"))

median_metrics_subset$metric <- factor(median_metrics_subset$metric, levels = c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals"))

ggplot(median_metrics_subset, aes(RegType, value, col = as.factor(StartBBMSY), 
                                  shape = as.factor(RegType), group = StartBBMSY)) + 
  geom_line() + 
  geom_point() + 
  facet_wrap(~metric, ncol = 3, scales = "free") +
  labs(x = "Fishing Regulation Decision", y = "Performance Metric Value", color = "Starting B/BMSY Scenario", shape = "Fishing Regulation Decision") +
  scale_color_manual(values = c( "0.3" = "#F8766D", "1" = "#00BA38", "2" = "#619CFF"),
                     labels = c("Start B/BMSY ~ 0.3", "Start B/BMSY ~ 1", "Start B/BMSY ~ 2")) +
  scale_shape_manual(values = c("Bag" = 17, "Length" = 15, "Season" = 3, "All" = 16),
                     labels = c("Bag limit (Bag)", "Minimum size limit (Length)", "Season length (Season)", "Any regulations can change (All)"))

###### LINE PLOT W/CI ###### not doing it like this since it makes the plot muddy; would need to edit code above to include CIs again 

#median_metrics22 <- readRDS("~/Desktop/FlounderMSE/median_metrics_rdsfiles/MSE_median_metrics_reg_CI.rds")

median_metrics22 <- median_metrics22 %>% rename(value = median_value)

median_metrics_1 <- median_metrics22 %>% filter(StartBBMSY == 1)

median_metrics_2 <- median_metrics22 %>% filter(StartBBMSY == 2)

median_metrics_03 <- median_metrics22 %>% filter(StartBBMSY == 0.3)

print(unique(median_metrics22$metric))

subset_metrics <- c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals")

median_metrics_subset$RegType <- factor(median_metrics_subset$metric, levels = c("Bag", "Length", "Season", "All"))

median_metrics_subset$metric <- factor(median_metrics_subset$metric, levels = c("rel per trip", "spawning biomass", "ntrips", "trophy",
                    "not overfishing", "not overfished", "kept per trip",
                    "keep_one", "prop_female", "kept:released", "cs_per_trip", "rec_removals"))

#first do it just as absolute values instead of how they scale in relation to 1
median_metrics_subset <- median_metrics22 %>% 
  filter(if_any(everything(), ~ .x %in% subset_metrics))

#if plotting Reg

#error bar 

#if stagger 
pd <- position_dodge(width = 0.5)

ggplot(median_metrics_subset, aes(RegType, value, col = as.factor(StartBBMSY), 
                                  shape = as.factor(RegType), group = StartBBMSY)) + 
  geom_line(position = pd) + 
  geom_point(position = pd) + 
  geom_errorbar(aes(ymin = lower_ci, ymax = upper_ci), width = 0.2, position = pd) +
  facet_wrap(~metric, ncol = 3, scales = "free") +
  labs(x = "Harvest Control Rule", y = "Performance Metric Value", color = "Starting B/BMSY Scenario", shape = "Harvest Control Rule") +
  scale_color_manual(values = c( "0.3" = "#F8766D", "1" = "#00BA38", "2" = "#619CFF"),
                     labels = c("Start B/BMSY ~ 0.3", "Start B/BMSY ~ 1", "Start B/BMSY ~ 2")) +
   scale_shape_manual(values = c("Bag" = 17, "Length" = 15, "Season" = 3, "All" = 16),
                     labels = c("Bag limit (Bag)", "Minimum size limit (Length)", "Season length (Season)", "Any regulations can change (All)"))

#ribbon?
ggplot(median_metrics_subset, aes(RegType, value, group = StartBBMSY)) + 
  geom_ribbon(aes(ymin = lower_ci, ymax = upper_ci, fill = as.factor(StartBBMSY)), alpha = 0.2, color = NA) +
  geom_line(aes(color = as.factor(StartBBMSY))) + 
  geom_point(aes(shape = as.factor(RegType), color = as.factor(StartBBMSY)), size = 2) +
  facet_wrap(~metric, ncol = 3, scales = "free") +
  labs(x = "Harvest Control Rule", y = "Performance Metric Value", color = "Starting B/BMSY Scenario", shape = "Harvest Control Rule") +
  scale_color_manual(values = c( "0.3" = "#F8766D", "1" = "#00BA38", "2" = "#619CFF"),
                     labels = c("Start B/BMSY ~ 0.3", "Start B/BMSY ~ 1", "Start B/BMSY ~ 2")) +
  scale_shape_manual(values = c("Bag" = 17, "Length" = 15, "Season" = 3, "All" = 16),
                     labels = c("Bag limit (Bag)", "Minimum size limit (Length)", "Season length (Season)", "Any regulations can change (All)"))
guides(fill = "none")
```

Released per trip counterfactuals - not in MS
```{r}
#full MSE sims 

#RDM only 
all_results_test <- all_results %>% filter(
  year != 2019)
#View(all_results_test)

diag_ts <- all_results_test %>%
  mutate(RegType = ifelse( #edits start here
    substr(all_results_test$scenario, 1,1) == "B", "Bag",
    ifelse(
      substr(all_results_test$scenario, 1,1) == "L", "Length",
      ifelse(
        substr(all_results_test$scenario, 1,1) == "S", "Season",
        ifelse(
          substr(all_results_test$scenario, 1,1) == "A", "All", NA  
        )))))

print(unique(diag_ts$minlen))

diag_ts$scenario <- ifelse(substr(diag_ts$scenario, 2,8) != "Table3.", "BBM",
                           ifelse(substr(diag_ts$scenario, 2,9) == "Table3.1", "BRP",
                                  ifelse(substr(diag_ts$scenario, 2,9) == "Table3.2", "PCA",
                                         ifelse(substr(diag_ts$scenario, 2,9) == "Table3.3", "NCA",
                                                ifelse(substr(diag_ts$scenario, 2,9) == "Table3.4", "Table3.4",
                                                       ifelse(substr(diag_ts$scenario, 2,9) == "Table3.5", "Table3.5",
                                                              ifelse(substr(diag_ts$scenario, 2,9) == "Table3.6", "Table3.6",
                                                                     ifelse(substr(diag_ts$scenario, 2,9) == "Table3.7", "Table3.7", NA))))))))

#View(diag_ts)

diag_ts_summary_rel <- diag_ts %>% 
  group_by(scenario, RegType) %>%
  summarise(mean_value = mean(n_release))
diag_ts_summary_rel

diag_ts_summary_ntrip <- diag_ts %>% 
  group_by(scenario, RegType) %>%
  summarise(mean_value = mean(ntrips))
diag_ts_summary_ntrip

diag_ts_summary_rel$mean_value/diag_ts_summary_ntrip$mean_value #consistent with what we're seeing in processed results

#marginal effects 

diag_ts_bag <- diag_ts %>% filter(RegType == "Bag") %>%
  filter(year >= 2036) %>%
  group_by(scenario, bag) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip)
#View(diag_ts_bag)

diag_ts_minlen <- diag_ts %>% filter(RegType == "Length") %>%
  filter(year >= 2036) %>%
  group_by(scenario, minlen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip)
#View(diag_ts_minlen)

diag_ts_seaslen <- diag_ts %>% filter(RegType == "Season") %>%
  filter(year >= 2036) %>%
  group_by(scenario, seaslen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip)
#View(diag_ts_seaslen)

custom_labels <- c(
  "BBM" = "Biomass Matrix",
  "BRP" = "Biological Ref. Point",
  "NCA" = "No Change (RHL)", 
  "PCA" = "Percent Change"
)

ggplot(diag_ts_bag, aes(bag, mean_value_relpertrip, col = as.factor(scenario))) + 
  geom_line() + 
  geom_point() + 
  xlab("Bag Limit") + 
  ylab("Mean Discards per Trip") + 
  ggtitle("Effect of Bag Limit on Discards") + 
  facet_wrap(~scenario, nrow = 2, ncol = 2, scales = "free", labeller = labeller(scenario = custom_labels)) + 
  scale_color_manual(
    name = "Harvest Control Rule",  
    values = c("BBM" = "#1b9e77", "BRP" = "#d95f02", "NCA" = "#7570b3", "PCA" = "#e7298a"),
    labels = custom_labels
  ) 

ggplot(diag_ts_minlen, aes(minlen, mean_value_relpertrip, col = as.factor(scenario))) + 
  geom_line() + 
  geom_point() + 
  xlab("Minimum Size Limit") + 
  ylab("Mean Discards per Trip") + 
  ggtitle("Effect of Minimum Size Limit on Discards") + 
  facet_wrap(~scenario, nrow = 2, ncol = 2, scales = "free", labeller = labeller(scenario = custom_labels)) + 
  scale_color_manual(
    name = "Harvest Control Rule",  
    values = c("BBM" = "#1b9e77", "BRP" = "#d95f02", "NCA" = "#7570b3", "PCA" = "#e7298a"),
    labels = custom_labels
  )

ggplot(diag_ts_seaslen, aes(seaslen, mean_value_relpertrip, col = as.factor(scenario))) + 
  geom_line() + 
  geom_point() +
  xlab("Season Length") + 
  ylab("Mean Discards per Trip") + 
  ggtitle("Effect of Season Length on Discards") + 
  facet_wrap(~scenario, nrow = 2, ncol = 2, scales = "free", labeller = labeller(scenario = custom_labels)) + 
  scale_color_manual(
    name = "Harvest Control Rule",  
    values = c("BBM" = "#1b9e77", "BRP" = "#d95f02", "NCA" = "#7570b3", "PCA" = "#e7298a"),
    labels = custom_labels
  )

#do it by quantile 

#BAG
diag_ts_bag <- diag_ts %>% filter(RegType == "Bag")
quant <- quantile(diag_ts_bag$biomass, probs = c(0.25, 0.5, 0.75))

quant0.25 <- quant[1]
quant0.5 <- quant[2]
quant0.75 <- quant[3]
quant <- max(diag_ts_bag$biomass)

diag_ts_bag_0.25 <- diag_ts %>% filter(RegType == "Bag") %>%
  filter(year >= 2036) %>%
  filter(biomass >= 0 & biomass <= quant0.25) %>% 
  group_by(scenario, bag) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Low")

diag_ts_bag_0.5 <- diag_ts %>% filter(RegType == "Bag") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.25 & biomass <= quant0.5) %>% 
  group_by(scenario, bag) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Medium")

diag_ts_bag_0.75 <- diag_ts %>% filter(RegType == "Bag") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.5 & biomass <= quant0.75) %>% 
  group_by(scenario, bag) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "High")

diag_ts_bag_1 <- diag_ts %>% filter(RegType == "Bag") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.75) %>% 
  group_by(scenario, bag) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Highest")

diag_ts_bag <- rbind(diag_ts_bag_0.25, diag_ts_bag_0.5, 
                     diag_ts_bag_0.75, diag_ts_bag_1)

custom_labels2 = c(
  "Low" = "0.25",
  "Medium" = "0.5",
  "High" = "0.75", 
  "Highest" = "1"
)

ggplot(diag_ts_bag, aes(bag, mean_value_relpertrip, col = as.factor(scenario), 
                        shape = as.factor(Scen), group = Scen)) + 
  geom_line() + 
  geom_point() + 
  xlab("Bag Limit") + 
  ylab("Mean Discards per Trip") + 
  ggtitle("Effect of Bag Limit on Discards") +
  facet_wrap(~scenario, ncol = 2, nrow = 2, scales = "free",  labeller = labeller(scenario = custom_labels)) + 
  scale_color_manual(
    name = "Harvest Control Rule",  
    values = c("BBM" = "#1b9e77", "BRP" = "#d95f02", "NCA" = "#7570b3", "PCA" = "#e7298a"),
    labels = custom_labels
  ) + 
  scale_shape_manual(
    name = "Quantile",  
    values = c("Low" = 16, "Medium" = 17, "High" = 15, "Highest" = 3),
    labels = custom_labels2
  )

#quant seems to make more sense 

#MINLEN
diag_ts_minlen <- diag_ts %>% filter(RegType == "Length")
quant <- quantile(diag_ts_minlen$biomass, probs = c(0.25, 0.5, 0.75))

quant0.25 <- quant[1]
quant0.5 <- quant[2]
quant0.75 <- quant[3]
quant <- max(diag_ts_minlen$biomass)

diag_ts_minlen_0.25 <- diag_ts %>% filter(RegType == "Length") %>%
  filter(year >= 2036) %>%
  filter(biomass >= 0 & biomass <= quant0.25) %>% 
  group_by(scenario, minlen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Low")

diag_ts_minlen_0.5 <- diag_ts %>% filter(RegType == "Length") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.25 & biomass <= quant0.5) %>% 
  group_by(scenario, minlen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Medium")

diag_ts_minlen_0.75 <- diag_ts %>% filter(RegType == "Length") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.5 & biomass <= quant0.75) %>% 
  group_by(scenario, minlen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "High")

diag_ts_minlen_1 <- diag_ts %>% filter(RegType == "Length") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.75) %>% 
  group_by(scenario, minlen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Highest")

diag_ts_minlen <- rbind(diag_ts_minlen_0.25, diag_ts_minlen_0.5, 
                     diag_ts_minlen_0.75, diag_ts_minlen_1)

ggplot(diag_ts_minlen, aes(minlen, mean_value_relpertrip, col = as.factor(scenario), 
                        shape = as.factor(Scen), group = Scen)) + 
  geom_line() + 
  geom_point() + 
  xlab("Minimum Size Limit") + 
  ylab("Mean Discards per Trip") + 
  ggtitle("Effect of Minimum Size Limit on Discards") +
  facet_wrap(~scenario, ncol = 2, nrow = 2, scales = "free",  labeller = labeller(scenario = custom_labels)) + 
  scale_color_manual(
    name = "Harvest Control Rule",  
    values = c("BBM" = "#1b9e77", "BRP" = "#d95f02", "NCA" = "#7570b3", "PCA" = "#e7298a"),
    labels = custom_labels
  ) + 
  scale_shape_manual(
    name = "Quantile",  
    values = c("Low" = 16, "Medium" = 17, "High" = 15, "Highest" = 3),
    labels = custom_labels2
  )

#SEASON LENGTH
diag_ts_season <- diag_ts %>% filter(RegType == "Season")
quant <- quantile(diag_ts_season$biomass, probs = c(0.25, 0.5, 0.75))

quant0.25 <- quant[1]
quant0.5 <- quant[2]
quant0.75 <- quant[3]
quant <- max(diag_ts_season$biomass)

diag_ts_season_0.25 <- diag_ts %>% filter(RegType == "Season") %>%
  filter(year >= 2036) %>%
  filter(biomass >= 0 & biomass <= quant0.25) %>% 
  group_by(scenario, seaslen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Low")

diag_ts_season_0.5 <- diag_ts %>% filter(RegType == "Season") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.25 & biomass <= quant0.5) %>% 
  group_by(scenario, seaslen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Medium")

diag_ts_season_0.75 <- diag_ts %>% filter(RegType == "Season") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.5 & biomass <= quant0.75) %>% 
  group_by(scenario, seaslen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "High")

diag_ts_season_1 <- diag_ts %>% filter(RegType == "Season") %>%
  filter(year >= 2036) %>%
  filter(biomass >= quant0.75) %>% 
  group_by(scenario, seaslen) %>% 
  summarise(mean_value = mean(n_release),
            mean_value_trip = mean(ntrips),
            mean_value_relpertrip = mean_value/mean_value_trip) %>% 
  mutate(Scen = "Highest")

diag_ts_season <- rbind(diag_ts_season_0.25, diag_ts_season_0.5, 
                        diag_ts_season_0.75, diag_ts_season_1)

ggplot(diag_ts_season, aes(seaslen, mean_value_relpertrip, col = as.factor(scenario), 
                           shape = as.factor(Scen), group = Scen)) + 
  geom_line() + 
  geom_point() + 
  xlab("Season Length") + 
  ylab("Mean Discards per Trip") + 
  ggtitle("Effect of Season Length on Discards") +
  facet_wrap(~scenario, ncol = 2, nrow = 2, scales = "free",  labeller = labeller(scenario = custom_labels)) + 
  scale_color_manual(
    name = "Harvest Control Rule",  
    values = c("BBM" = "#1b9e77", "BRP" = "#d95f02", "NCA" = "#7570b3", "PCA" = "#e7298a"),
    labels = custom_labels
  ) + 
  scale_shape_manual(
    name = "Quantile",  
    values = c("Low" = 16, "Medium" = 17, "High" = 15, "Highest" = 3),
    labels = custom_labels2
  )

#RDM only 

#see RelPerTrip_RDM.R code (not seeded)
```

Junk for manually calculating mean/median and comparing to plots; changed diag_ts function to not have "per trip" - not in MS
```{r}
#junk for calculating mean regs per HCR scenario 

#mean bag limit per HCR 
meanbag_all_bbm <- diag_ts %>% filter(scenario == "BBM", RegType == "All", type == "bag", year != 2019) 
mean(meanbag_all_bbm$value)
meanbag_bag_bbm <- diag_ts %>% filter(scenario == "BBM", RegType == "Bag", type == "bag", year != 2019)
mean(meanbag_bag_bbm$value)

meanbag_all_brp <- diag_ts %>% filter(scenario == "BRP", RegType == "All", type == "bag", year != 2019) 
mean(meanbag_all_brp$value)
meanbag_bag_brp <- diag_ts %>% filter(scenario == "BRP", RegType == "Bag", type == "bag", year != 2019)
mean(meanbag_bag_brp$value)

meanbag_all_nca <- diag_ts %>% filter(scenario == "NCA", RegType == "All", type == "bag", year != 2019) 
mean(meanbag_all_nca$value)
meanbag_bag_nca <- diag_ts %>% filter(scenario == "NCA", RegType == "Bag", type == "bag", year != 2019)
mean(meanbag_bag_nca$value)

meanbag_all_pca <- diag_ts %>% filter(scenario == "PCA", RegType == "All", type == "bag", year != 2019) 
mean(meanbag_all_pca$value)
meanbag_bag_pca <- diag_ts %>% filter(scenario == "PCA", RegType == "Bag", type == "bag", year != 2019)
mean(meanbag_bag_pca$value)

#mean minimum size limit per HCR
meansize_all_bbm <- diag_ts %>% filter(scenario == "BBM", RegType == "All", type == "minlen", year != 2019) 
mean(meansize_all_bbm$value)
meansize_size_bbm <- diag_ts %>% filter(scenario == "BBM", RegType == "Length", type == "minlen", year != 2019)
mean(meansize_size_bbm$value)

meansize_all_brp <- diag_ts %>% filter(scenario == "BRP", RegType == "All", type == "minlen", year != 2019) 
mean(meansize_all_brp$value)
meansize_size_brp <- diag_ts %>% filter(scenario == "BRP", RegType == "Length", type == "minlen", year != 2019)
mean(meansize_size_brp$value)

meansize_all_nca <- diag_ts %>% filter(scenario == "NCA", RegType == "All", type == "minlen", year != 2019) 
mean(meansize_all_nca$value)
meansize_size_nca <- diag_ts %>% filter(scenario == "NCA", RegType == "Length", type == "minlen", year != 2019)
mean(meansize_size_nca$value)

meansize_all_pca <- diag_ts %>% filter(scenario == "PCA", RegType == "All", type == "minlen", year != 2019) 
mean(meansize_all_pca$value)
meansize_size_pca <- diag_ts %>% filter(scenario == "PCA", RegType == "Length", type == "minlen", year != 2019)
mean(meansize_size_pca$value)

#mean season length per HCR 
meanseas_all_bbm <- diag_ts %>% filter(scenario == "BBM", RegType == "All", type == "seaslen", year != 2019) 
mean(meanseas_all_bbm$value)
meanseas_size_bbm <- diag_ts %>% filter(scenario == "BBM", RegType == "Season", type == "seaslen", year != 2019)
mean(meanseas_size_bbm$value)

meanseas_all_brp <- diag_ts %>% filter(scenario == "BRP", RegType == "All", type == "seaslen", year != 2019) 
mean(meanseas_all_brp$value)
meanseas_size_brp <- diag_ts %>% filter(scenario == "BRP", RegType == "Season", type == "seaslen", year != 2019)
mean(meanseas_size_brp$value)

meanseas_all_nca <- diag_ts %>% filter(scenario == "NCA", RegType == "All", type == "seaslen", year != 2019) 
mean(meanseas_all_nca$value)
meanseas_size_nca <- diag_ts %>% filter(scenario == "NCA", RegType == "Season", type == "seaslen", year != 2019)
mean(meanseas_size_nca$value)

meanseas_all_pca <- diag_ts %>% filter(scenario == "PCA", RegType == "All", type == "seaslen", year != 2019) 
mean(meanseas_all_pca$value)
meanseas_size_pca <- diag_ts %>% filter(scenario == "PCA", RegType == "Season", type == "seaslen", year != 2019)
mean(meanseas_size_pca$value)

#have anything "per trip" be a total number; doesn't solve some of the other proportion ones (e.g. kept:released ratio)

#run this modified function before creating diag_ts dataframe 
get_diag_ts <- function(results) {
  
diag_ts <- results %>% 
  mutate(keep_to_rel = keep_num/release_num,
         change_cs = change_cs*-1,
       #  "kept per trip" = keep_num/ntrips,
       #  "rel per trip" = release_num/ntrips,
         "kept per trip" = 1000*keep_num,
         "rel per trip" = 1000*release_num,
         "F/Fref" = frate/fmsy,
         "B/Bref" = biomass/bmsy,
         "expense" = cost,
         cs_per_trip = change_cs,
         rec_removals = keep_wt + release_wt,
         keep_one = keep_one,
         keep_to_exp = 1000*keep_num / (exp_keep))  %>% 
  select(om, scenario, isim, year, biomass, totcat_wt, rec_removals, keep_to_rel, "kept per trip", "rel per trip",
         "F/Fref", "B/Bref",
         mulen_keep,
         mulen_release,
         trophy,
         expense,
         change_cs,
         ntrips,
         keep_one,
         cs_per_trip,
         prop_female,
         keep_to_exp,
         bag,
         minlen,
         seaslen,
         exp_keep
         ) %>% 
  rename("spawning biomass" = biomass,
         "total catch" = totcat_wt,
         "kept:released" = keep_to_rel) %>% 
  pivot_longer(cols=c("spawning biomass","total catch","kept:released", "kept per trip", 
                      "rel per trip",
                      "F/Fref", "B/Bref",
                      rec_removals,
                      mulen_keep,
                      mulen_release,
                      trophy,
                      expense,
                      change_cs,
                      ntrips,
                      keep_one,
                      cs_per_trip,
                      prop_female,
                      keep_to_exp,
                      bag,
                      minlen,
                      seaslen,
                      exp_keep
                      ),names_to = "type", values_to = "value") %>% 
  I()
 return(diag_ts)
}
```

Other Plots from 2024 MSE <- haven't been used since - not in MS
```{r}
tempcat <- flukecatch %>% 
  janitor::clean_names() %>% 
  group_by(bag, min_len, season_len) %>% 
  summarize(land = sum(land),
            disc = sum(disc)) %>% 
  ungroup()

catuse <- tempcat %>%
  filter(min_len == max(min_len),
         bag == 4,
         season_len == 150)

tempcat <- tempcat %>% 
  mutate(land = land/catuse$land[1],
         disc = disc/catuse$disc[1])

tempcat %>% 
  filter(season_len == 150) %>% 
  ggplot() +
  aes(x = land) +
  geom_histogram(col="white") +
  theme_bw() +
  facet_wrap(~bag) +
  geom_vline(xintercept = 1.05, lty=2) +
  geom_vline(xintercept = 1.1, lty=2) +
  geom_vline(xintercept = 1.2, lty=2) +
  geom_vline(xintercept = 1.3, lty=2) +
  geom_vline(xintercept = 1.4, lty=2) +
  geom_vline(xintercept = 1.6, lty=2) +
  labs(x = "expected harvest compared to minimum") +
  NULL

# tempcat %>% 
#   filter(min_len == 17.5) %>% 
#   ggplot() +
#   aes(x = land) +
#   geom_histogram(col="white") +
#   theme_bw() +
#   facet_wrap(~bag) +
#   NULL

tempcat %>% 
  filter(season_len == 150) %>% 
  ggplot() +
  aes(x = land) +
  geom_histogram(col="white") +
  theme_bw() +
  #facet_wrap(~bag) +
  geom_vline(xintercept = 1.05, lty=2) +
  geom_vline(xintercept = 1.1, lty=2) +
  geom_vline(xintercept = 1.2, lty=2) +
  geom_vline(xintercept = 1.3, lty=2) +
  geom_vline(xintercept = 1.4, lty=2) +
  geom_vline(xintercept = 1.6, lty=2) +
  labs(x = "expected harvest compared to minimum") +
  NULL


tempcat %>% 
  #filter(season_len == 150) %>% 
  ggplot() +
  aes(x = land) +
  geom_histogram(col="white") +
  theme_bw() +
  #facet_wrap(~bag) +
  geom_vline(xintercept = 1.05, lty=2) +
  geom_vline(xintercept = 1.1, lty=2) +
  geom_vline(xintercept = 1.2, lty=2) +
  geom_vline(xintercept = 1.3, lty=2) +
  geom_vline(xintercept = 1.4, lty=2) +
  geom_vline(xintercept = 1.6, lty=2) +
  labs(x = "expected harvest compared to minimum") +
  NULL


#######

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3") )) %>% 
  ggplot() + 
  aes(x = biomass, y = ratio, col = minlen) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  #geom_abline(slope = 1, intercept = 0) + 
  geom_hline(yintercept = 1, lty=2) +
  geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL



all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
        mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3") )) %>% 
  ggplot() + 
  aes(x = biomass, y = ratio, col = seaslen) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  #geom_abline(slope = 1, intercept = 0) + 
  geom_hline(yintercept = 1, lty=2) +
  geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL



all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3") )) %>% 
  ggplot() + 
  aes(x = biomass, y = ratio, col = bag) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  #geom_abline(slope = 1, intercept = 0) + 
  geom_hline(yintercept = 1, lty=2) +
  geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL


####

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
        mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3") )) %>% 
  ggplot() + 
  aes(x = 0.39*exp_keep, y = 1000*keep_num, size = biomass, col = biomass) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
  geom_smooth(method = "glm", formula = y ~ x, method.args = list(family = "poisson"), col ="blue") +
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  labs(    y = "harvest number from RDM",
           x = "expected harvest from GAM") +
  NULL

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3") )) %>% 
  ggplot() + 
  aes(x = 0.39*exp_keep, y = 1000*keep_num, col = bag) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
       mp2 = fct_collapse(scenario,
                            "rhl" = c("BTable3.3","LTable3.3","STable3.3", "ATable3.3"),
                            "perc_change" = c("BTable3.2","LTable3.2","STable3.2", "ATable3.2"), 
                            "refpt" = c("BTable3.1","LTable3.1","STable3.1", "ATable3.1"),
                            "bmatrix" = c("BTable3","LTable3","STable3", "ATable3")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("BTable3","BTable3.1","BTable3.2", "BTable3.3"),
                            "minlen" = c("LTable3","LTable3.1","LTable3.2","LTable3.3"),
                            "season" = c("STable3","STable3.1","STable3.2","STable3.3"),
                            "all" = 
                        c("ATable3","ATable3.1","ATable3.2","ATable3.3") )) %>% 
  ggplot() + 
  aes(x = 0.39*exp_keep, y = 1000*keep_num, col = seaslen) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL


glm1 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep) %>% 
  #glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =., family = "poisson") # 
  glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =.) #, family = "poisson") # 
library(broom)
bob <- augment(glm1, type.predict = "response")
bob %>% 
  janitor::clean_names() %>% 
  select(-biomass,-bag,-seaslen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  aes(x = log_kept, y = fitted, col = seaslen) + #biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  NULL


glm2 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep) %>% 
  #glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =., family = "poisson") # 
  lm(formula = log(kept) ~ log(pred)*minlen + biomass + seaslen, data =.) #, family = "poisson") # 
library(broom)
bob <- augment(glm2, type.predict = "response")
p2 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass,-minlen, -seaslen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  #aes(x = log_kept, y = fitted, col = biomass) +
  aes(x = exp(log_kept), y = exp(fitted), col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL

p1 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass,-minlen, -seaslen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  aes(x = exp(log_kept), y = exp(log_pred), col = biomass) +
  #aes(x = exp(log_kept), y = exp(fitted), col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL

p1+p2

df_use <-  all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep)
df_use %>% 
  ggplot() +
  aes(x = pred, y = kept, col = minlen, group = as.factor(minlen)) +
  geom_point() +
  geom_smooth(method = "lm") +
  geom_abline(slope = 1, intercept = 0) +
  NULL


glm3 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep) %>% 
  #glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =., family = "poisson") # 
  lm(formula = log(kept) ~ log(pred) + biomass, data =.) #, family = "poisson") # 
bob <- augment(glm3, type.predict = "response")
p3 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  #aes(x = log_kept, y = fitted, col = biomass) +
  aes(x = exp(log_kept), y = exp(fitted), col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL

p2 + p3  
  
glm4 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = exp_keep) %>% 
  glm(formula = kept ~ pred + minlen + biomass + seaslen + bag, data =., family = "poisson") # 
  #lm(formula = log(kept) ~ log(pred) + biomass, data =.) #, family = "poisson") # 
bob <- augment(glm4, type.predict = "response")
p4 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass, -seaslen, -minlen, -bag) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  #aes(x = log_kept, y = fitted, col = biomass) +
  aes(x = kept, y = fitted, col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  #facet_wrap(~bag, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  ylim(0, 5000000) +
  xlim(0, 5000000) +
  labs(x = "RDM",
       y = "fitted from GAM") +
  NULL
p4
100*with(summary(glm4), 1 - deviance/null.deviance)


  

glm5 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = exp_keep) %>% 
  glm(formula = kept ~ pred + biomass, data =., family = "poisson") # 
#lm(formula = log(kept) ~ log(pred) + biomass, data =.) #, family = "poisson") # 
bob <- augment(glm5, type.predict = "response")
nudata <- expand.grid(pred = seq(0,1e+07,by=100), biomass = seq(20000,60000,by=5000)) %>% 
  tibble()
nudata$est <- predict(glm5, newdata = nudata, type = "response")

p5 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  #select(-biomass, -minlen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  #filter(seaslen == 150, minlen == 17.5) %>% 
  ggplot() +
  #aes(y = kept, x = pred, col = biomass) +
  #aes(x = exp_keep, y = fitted, col = bag) +
  #geom_point(alpha = 0.2) +
  geom_line(data = nudata, aes(x = pred, y = est, group = biomass, col=biomass)) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  #facet_wrap(~bag) + #, scales = "free") +
  #geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL
p5
100*with(summary(glm5), 1 - deviance/null.deviance)
100*with(summary(glm4), 1 - deviance/null.deviance)



# gam5 <- all_results %>% 
#   mutate(kept = 1000*keep_num,
#          pred = exp_keep) %>% 
#   gam(formula = kept ~ pred + s(biomass), data =., family = "poisson") # 
# summary(gam5)
# gratia::draw(gam5)

p6 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  #select(-biomass, -minlen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  #filter(seaslen == 150, minlen == 17.5) %>% 
  ggplot() +
  aes(y = kept, x = pred, col = biomass) +
  #aes(x = kept, y = fitted, col = bag) +
  geom_point(alpha = 0.2) +
  #geom_point(aes(y = fitted),col = "orange", alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  #facet_wrap(~bag, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL
p6
p6 + p5

p7 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  #select(-biomass, -minlen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  filter(seaslen == 150, minlen == 17.5) %>% 
  ggplot() +
#  aes(y = kept, group = bag) +
#  geom_boxplot()
  aes(x = fitted, y = kept, col = biomass) +
  #aes(x = kept, y = fitted, col = bag) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  facet_wrap(~bag) + #, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL
p7
flukecatch <- readRDS("~/Desktop/FlounderMSE/state_lookup.rds")
dat_use <- flukecatch %>% 
  janitor::clean_names() %>% 
  group_by(bag, min_len, season_len) %>% 
  summarize(land = sum(land),
            disc = sum(disc), .groups = "drop")
dat_use

dat_use %>% 
  ggplot() + 
  aes(x = min_len, y = land, group = season_len, col = season_len) +
  geom_line() +
  facet_wrap(~bag) +
  scale_color_viridis_c() +
  theme_bw() + 
  ylim(0,NA) +
  NULL
```

Older Runs all Plots from original performance metrics/summary metrics code - not in MS
```{r}
#actually no more scalar for post-calib GAM
all_results %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = 1000*keep_num, x = exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from HCR"
  ) +
  #facet_wrap(~bag) +
  xlim(1e6,1e7) +
  ylim(0,3.5e+07) +
  NULL

#with scalar
all_results %>% 
  #filter(bag == 4, seaslen == 150) %>% 
  drop_na() %>% 
  ggplot() + 
  aes(y = 1000*keep_num, x = 0.39*exp_keep, col = biomass) + 
  geom_point(alpha=0.1) + 
  #geom_point() + 
  geom_abline(slope = 1, intercept = 0) + 
  scale_color_viridis_c() +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from HCR"
  ) +
  #facet_wrap(~bag) +
  xlim(0,1e7) +
  ylim(0,2e+07) +
  NULL

#all_results1 <- all_results
#View(all_results)
flukecatch <- readRDS("~/Desktop/FlounderMSE/state_lookup.rds")

projection.plot <- function(project.results) {
  project.results <- project.results %>% 
    #filter(type %in% c("biomass","catch")) %>%
    I()
  project.results %>% 
    #group_by(scenario, type, year) %>% 
    #median_qi(value, .width = c(.5, .8, .95)) %>%
    ggplot() +  
    stat_lineribbon(aes(x = year, y = value, fill = mp2),
                    #show.legend = FALSE,
                    alpha = 0.35) +
    # geom_lineribbon(aes(x = year, y = value, ymin = .lower, ymax = .upper, fill = scenario),
    #                 show.legend = FALSE) +
    scale_fill_brewer(type = "qual", palette = 2) +
    facet_wrap(~mp2, scale = "free") + 
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==1), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==2), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==3), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    geom_line(aes(y=value,x=year,group=scenario),data = subset(project.results, type != "index" & isim==4), lty=1,lwd=0.5,col=gray(0.7),alpha=0.75) +
    ylim(0,3000) + 
    ylab("") + 
    theme_bw() +
    theme(legend.position= "none") + #,
    #axis.text.y = element_blank()) +
    labs(fill = "",
         subtitle = "expected harvest (1000s)")
}

diag_ts %>% 
  mutate(value = ifelse(type == "exp_keep", 0.39*value/1000, value),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  filter(year != 2019) %>% 
#  mutate(type = fct_relevel(type,c("spawning biomass", "total catch"))) %>% 
  filter(type == "exp_keep",
         mp3 == "minlen") %>% 
  projection.plot()

tempcat <- flukecatch %>% 
  janitor::clean_names() %>% 
  group_by(bag, min_len, season_len) %>% 
  summarize(land = sum(land),
            disc = sum(disc)) %>% 
  ungroup()

catuse <- tempcat %>%
  filter(min_len == max(min_len),
         bag == 4,
         season_len == 150)

tempcat <- tempcat %>% 
  mutate(land = land/catuse$land[1],
         disc = disc/catuse$disc[1])

tempcat %>% 
  filter(season_len == 150) %>% 
  ggplot() +
  aes(x = land) +
  geom_histogram(col="white") +
  theme_bw() +
  facet_wrap(~bag) +
  geom_vline(xintercept = 1.05, lty=2) +
  geom_vline(xintercept = 1.1, lty=2) +
  geom_vline(xintercept = 1.2, lty=2) +
  geom_vline(xintercept = 1.3, lty=2) +
  geom_vline(xintercept = 1.4, lty=2) +
  geom_vline(xintercept = 1.6, lty=2) +
  labs(x = "expected harvest compared to minimum") +
  NULL

# tempcat %>% 
#   filter(min_len == 17.5) %>% 
#   ggplot() +
#   aes(x = land) +
#   geom_histogram(col="white") +
#   theme_bw() +
#   facet_wrap(~bag) +
#   NULL

tempcat %>% 
  filter(season_len == 150) %>% 
  ggplot() +
  aes(x = land) +
  geom_histogram(col="white") +
  theme_bw() +
  #facet_wrap(~bag) +
  geom_vline(xintercept = 1.05, lty=2) +
  geom_vline(xintercept = 1.1, lty=2) +
  geom_vline(xintercept = 1.2, lty=2) +
  geom_vline(xintercept = 1.3, lty=2) +
  geom_vline(xintercept = 1.4, lty=2) +
  geom_vline(xintercept = 1.6, lty=2) +
  labs(x = "expected harvest compared to minimum") +
  NULL


tempcat %>% 
  #filter(season_len == 150) %>% 
  ggplot() +
  aes(x = land) +
  geom_histogram(col="white") +
  theme_bw() +
  #facet_wrap(~bag) +
  geom_vline(xintercept = 1.05, lty=2) +
  geom_vline(xintercept = 1.1, lty=2) +
  geom_vline(xintercept = 1.2, lty=2) +
  geom_vline(xintercept = 1.3, lty=2) +
  geom_vline(xintercept = 1.4, lty=2) +
  geom_vline(xintercept = 1.6, lty=2) +
  labs(x = "expected harvest compared to minimum") +
  NULL


#######

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  ggplot() + 
  aes(x = biomass, y = ratio, col = minlen) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  #geom_abline(slope = 1, intercept = 0) + 
  geom_hline(yintercept = 1, lty=2) +
  geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL



all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  ggplot() + 
  aes(x = biomass, y = ratio, col = seaslen) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  #geom_abline(slope = 1, intercept = 0) + 
  geom_hline(yintercept = 1, lty=2) +
  geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL



all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  ggplot() + 
  aes(x = biomass, y = ratio, col = bag) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  #geom_abline(slope = 1, intercept = 0) + 
  geom_hline(yintercept = 1, lty=2) +
  geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL


####

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  ggplot() + 
  aes(x = 0.39*exp_keep, y = 1000*keep_num, size = biomass, col = biomass) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
  geom_smooth(method = "glm", formula = y ~ x, method.args = list(family = "poisson"), col ="blue") +
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  labs(    y = "harvest number from RDM",
           x = "expected harvest from GAM") +
  NULL

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  ggplot() + 
  aes(x = 0.39*exp_keep, y = 1000*keep_num, col = bag) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL

all_results %>% 
  mutate(ratio = 1000*keep_num / (0.39*exp_keep),
         mp2 = fct_collapse(scenario,
                            "rhl" = c("MP 4","MP 8", "MP 12"),
                            "perc_change" = c("MP 1","MP 5","MP 9"), 
                            "refpt" = c("MP 2", "MP 6","MP 10"),
                            "bmatrix" = c("MP 3","MP 7","MP 11")),
         mp3 = fct_collapse(scenario,
                            "bag" = c("MP 4","MP 1","MP 2", "MP 3"),
                            "minlen" = c("MP 8","MP 5","MP 6","MP 7"),
                            "season" = c("MP 12","MP 9","MP 10","MP 11"))) %>% 
  ggplot() + 
  aes(x = 0.39*exp_keep, y = 1000*keep_num, col = seaslen) + #col = mulen_keep) + 
  geom_point(alpha=0.1) + 
  geom_abline(slope = 1, intercept = 0) + 
  #geom_hline(yintercept = 1, lty=2) +
  #geom_hline(yintercept = 2.564, lty=2) +
  scale_color_viridis_c() +
  ylim(0,NA) +
  facet_wrap(~mp3) +
  NULL


glm1 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep) %>% 
  #glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =., family = "poisson") # 
  glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =.) #, family = "poisson") # 
library(broom)
bob <- augment(glm1, type.predict = "response")
bob %>% 
  janitor::clean_names() %>% 
  select(-biomass,-bag,-seaslen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  aes(x = log_kept, y = fitted, col = seaslen) + #biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  NULL


glm2 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep) %>% 
  #glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =., family = "poisson") # 
  lm(formula = log(kept) ~ log(pred)*minlen + biomass + seaslen, data =.) #, family = "poisson") # 
library(broom)
bob <- augment(glm2, type.predict = "response")
p2 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass,-minlen, -seaslen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  #aes(x = log_kept, y = fitted, col = biomass) +
  aes(x = exp(log_kept), y = exp(fitted), col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL

p1 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass,-minlen, -seaslen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  aes(x = exp(log_kept), y = exp(log_pred), col = biomass) +
  #aes(x = exp(log_kept), y = exp(fitted), col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL

p1+p2

df_use <-  all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep)
df_use %>% 
  ggplot() +
  aes(x = pred, y = kept, col = minlen, group = as.factor(minlen)) +
  geom_point() +
  geom_smooth(method = "lm") +
  geom_abline(slope = 1, intercept = 0) +
  NULL


glm3 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = 0.39*exp_keep) %>% 
  #glm(formula = log(kept) ~ pred + biomass + bag + seaslen,data =., family = "poisson") # 
  lm(formula = log(kept) ~ log(pred) + biomass, data =.) #, family = "poisson") # 
bob <- augment(glm3, type.predict = "response")
p3 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  #aes(x = log_kept, y = fitted, col = biomass) +
  aes(x = exp(log_kept), y = exp(fitted), col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL

p2 + p3  
  
glm4 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = exp_keep) %>% 
  glm(formula = kept ~ pred + minlen + biomass + seaslen + bag, data =., family = "poisson") # 
  #lm(formula = log(kept) ~ log(pred) + biomass, data =.) #, family = "poisson") # 
bob <- augment(glm4, type.predict = "response")
p4 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass, -seaslen, -minlen, -bag) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  ggplot() +
  #aes(x = log_kept, y = fitted, col = biomass) +
  aes(x = kept, y = fitted, col = biomass) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  #facet_wrap(~bag, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  ylim(0, 5000000) +
  xlim(0, 5000000) +
  labs(x = "RDM",
       y = "fitted from GAM") +
  NULL
p4
100*with(summary(glm4), 1 - deviance/null.deviance)
  
library(broom)
glm5 <- all_results %>% 
  mutate(kept = 1000*keep_num,
         pred = exp_keep) %>% 
  glm(formula = kept ~ pred + biomass, data =., family = "poisson") # 
#lm(formula = log(kept) ~ log(pred) + biomass, data =.) #, family = "poisson") # 
bob <- augment(glm5, type.predict = "response")
nudata <- expand.grid(pred = seq(0,1e+07,by=100), biomass = seq(20000,60000,by=5000)) %>% 
  tibble()
nudata$est <- predict(glm5, newdata = nudata, type = "response")

p5 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  #select(-biomass, -minlen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  #filter(seaslen == 150, minlen == 17.5) %>% 
  ggplot() +
  #aes(y = kept, x = pred, col = biomass) +
  #aes(x = exp_keep, y = fitted, col = bag) +
  #geom_point(alpha = 0.2) +
  geom_line(data = nudata, aes(x = pred, y = est, group = biomass, col=biomass)) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  #facet_wrap(~bag) + #, scales = "free") +
  #geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL
p5
100*with(summary(glm5), 1 - deviance/null.deviance)
100*with(summary(glm4), 1 - deviance/null.deviance)



# gam5 <- all_results %>% 
#   mutate(kept = 1000*keep_num,
#          pred = exp_keep) %>% 
#   gam(formula = kept ~ pred + s(biomass), data =., family = "poisson") # 
# summary(gam5)
# gratia::draw(gam5)

p6 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  #select(-biomass, -minlen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  #filter(seaslen == 150, minlen == 17.5) %>% 
  ggplot() +
  aes(y = kept, x = pred, col = biomass) +
  labs(
    y = "harvest number from RDM",
    x = "expected harvest from HCR"
  ) +
  #aes(x = kept, y = fitted, col = bag) +
  geom_point(alpha = 0.2) +
  #geom_point(aes(y = fitted),col = "orange", alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  #facet_wrap(~bag, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL
p6
p6 + p5

p7 <- bob %>% 
  janitor::clean_names() %>% 
  select(-biomass) %>% 
  #select(-biomass, -minlen) %>% 
  bind_cols(all_results %>% slice(as.integer(bob$.rownames))) %>% 
  filter(seaslen == 150, minlen == 17.5) %>% 
  ggplot() +
#  aes(y = kept, group = bag) +
#  geom_boxplot()
  aes(x = fitted, y = kept, col = biomass) +
  #aes(x = kept, y = fitted, col = bag) +
  geom_point(alpha = 0.2) +
  scale_color_viridis_c() +
  #facet_wrap(~minlen, scales = "free") +
  facet_wrap(~bag) + #, scales = "free") +
  geom_abline(slope = 1, intercept = 0) + 
  #ylim(0, 6e+07) +
  NULL
p7

dat_use <- flukecatch %>% 
  janitor::clean_names() %>% 
  group_by(bag, min_len, season_len) %>% 
  summarize(land = sum(land),
            disc = sum(disc), .groups = "drop")
dat_use

dat_use %>% 
  ggplot() + 
  aes(x = min_len, y = land, group = season_len, col = season_len) +
  geom_line() +
  facet_wrap(~bag) +
  scale_color_viridis_c() +
  theme_bw() + 
  ylim(0,NA) +
  NULL
```

